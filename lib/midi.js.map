{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 5244c911caf17485bb78","webpack:///./src/index.js","webpack:///./src/root.js","webpack:///./src/loader.js","webpack:///./src/utils/index.js","webpack:///./src/utils/audio-detect.js","webpack:///./src/utils/load-script.js","webpack:///./src/utils/request.js","webpack:///./src/gm.js","webpack:///./src/player.js","webpack:///./src/jasmid/index.js","webpack:///./src/jasmid/midifile.js","webpack:///./src/jasmid/_stream.js","webpack:///./src/jasmid/replayer.js","webpack:///./~/precise-interval/lib/index.js","webpack:///./src/plugins/index.js","webpack:///./src/plugins/audiotag.js","webpack:///./src/plugins/webaudio.js","webpack:///./src/plugins/webmidi.js"],"names":["window","MIDI","root","MidiPlayer","API","WebMIDI","enabled","avaliable","WebAudio","api","AudioTag","MidiChannelMapping","setController","event","channel","type","value","delay","apiName","programChange","program","pitchBend","noteOn","note","velocity","noteOff","stopAllNotes","lookAhead","stopImmediatelyIfPossible","Soundfont","DEBUG","USE_XHR","soundfontUrl","loadPlugin","opts","onsuccess","supports","hash","location","success","console","log","audioFormat","targetFormat","__api","__audioFormat","loadResource","list","webmidi","push","connect","AudioContext","item","instruments","instrument","i","length","GM","byId","id","format","audiotag","requestQueue","webaudio","context","onprogress","onerror","pending","waitForEnd","instrumentId","sendRequest","evt","progress","fileProgress","queueProgress","soundfontPath","url","responseText","script","document","createElement","language","text","body","appendChild","loadScript","add","verify","setDefaultPlugin","midi","canPlayThrough","src","audio","Audio","mime","split","setAttribute","addEventListener","removeChild","audioDetect","navigator","requestMIDIAccess","isNative","Function","prototype","toString","call","indexOf","n","plugins","plugin","name","webkitAudioContext","canPlayType","vorbis","mpeg","time","Date","getTime","interval","setInterval","now","maxExecution","clearInterval","_globalExists","path","join","parts","object","key","e","LoadScript","loaded","loading","config","that","urls","doc","getElementsByTagName","testElement","element","test","getNext","hasError","batchTest","addElement","onreadystatechange","readyState","onload","removeTest","ret","onLoad","istrue","strictOrder","error","setTimeout","ID","request","data","method","headers","responseType","withCredentials","xhr","XMLHttpRequest","open","setRequestHeader","overrideMimeType","upload","total","totalBytes","lengthComputable","status","res","target","responseXML","JSON","parse","response","err","send","map","clean","replace","toLowerCase","byName","byCategory","num","parseInt","substr","number","category","getInstrument","channelId","channels","setInstrument","getMono","mono","setMono","truthy","getOmni","omni","setOmni","getSolo","solo","setSolo","mute","keyToNote","noteToKey","A0","C8","number2key","octave","Player","player","currentTime","endTime","restart","playing","timeWarp","startDelay","BPM","TimeSignitures","OverrideProgramChanges","playingStartTime","ctxStartTime","lastCallbackTime","minLookAheadTime","useMetronome","queuedTime","currentProcessedEventTime","noteRegistrar","noteOffRegistrar","onMidiEvent","start","resume","insideLoop","stopAudio","scheduleLoop","startAudio","startTime","ctxDelay","recordCtxStartTime","subtype","programNumber","rawData","ctx","getContext","eventPosition","replayer","getData","getLength","getDisplayedAudioContextPlaytime","o","message","endPlaybackMidiData","end","loopHandler","getAudioContextPlaytime","ctxTime","performance","loopStart","undefined","loopEnd","loopDuration","pause","tmp","stop","addListener","removeListener","setOnLoopRestartedListener","onLoopRestarted","removeOnLoopRestartedListener","setLoop","trace","cancelLoop","totalTime","lastLoopTime","hasLooped","offset","messages","dt","obj","stopNoteDelay","metronomeEventsType","controllerType","noteNumber","MIDIOffset","track","noteOffData","noteOnData","lastDisplayedAudioContextPlaytime","onLoopCallBack","setChannelMute","isMuted","setUseMetronome","getActiveNotes","notes","__now","getNow","clearAnimation","animationFrameId","cancelAnimationFrame","setAnimation","callback","tOurTime","tTheirTime","frame","requestAnimationFrame","t1","t2","events","onEnd","loadMidiFile","currentData","Replayer","Measures","loadFile","file","atob","Promise","resolve","reject","fetch","t","ff","mx","scc","String","fromCharCode","z","charCodeAt","getFileInstruments","programs","gm","isFinite","MidiFile","lastEventTypeByte","readChunk","stream","read","readInt32","readEvent","deltaTime","readVarInt","clearLastReadBytes","eventTypeByte","readInt8","subtypeByte","Error","readInt16","microsecondsPerBeat","hourByte","frameRate","hour","min","sec","subframe","numerator","denominator","Math","pow","metronome","thirtyseconds","scale","_length","_length2","param1","eventType","amount","getLastReadBytes","headerChunk","headerStream","formatType","trackCount","timeDivision","ticksPerBeat","header","tracks","trackChunk","trackStream","eof","str","position","lastReadBytes","slice","moveReadPosition","index","result","signed","b","clone","midiFile","eventProcessor","bpm","inputTimeSignitures","inputMeasures","trackStates","beatsPerMinute","bpmOverride","timeSignitures","measures","getNextEvent","ticksToNextEvent","nextEventTrack","nextEventIndex","nextEvent","addMetronomeEvents2","currentTick","ticksToProcess","temporal","endingTick","totalWait","measureTick","measureEndTick","endTick","sign","getTimeSignitureForMeasure","beatTime","wait","addSingleMetronomeEvent","addMetronomeEvents","signTime","nextSignTime","beatsToGenerate","secondsToGenerate","measureTime","totalTick","midiEvent","processEvents","processNext","ticksInMetronomeEvents","ticksToEvent","s","volume","bufferNid","audioBuffers","notesOn","nid","playChannel","instrumentNoteId","play","stopChannel","len","cId","setVolume","chordOn","chord","idx","chordOff","base64ToArrayBuffer","base64","binaryString","bytes","Uint8Array","buffer","useStreamingBuffer","sources","effects","masterVolume","noteId","bufferId","source","createMediaElementSource","createBufferSource","chain","input","gain","destination","playbackRate","gainNode","createGain","max","linearRampToValueAtTime","sid","setEffects","tunajs","effect","setContext","createAudioContext","newCtx","Tuna","bufferPending","requestAudio","soundfont","loadAudio","isLoaded","synth","controls","autoplay","preload","decodeAudioData","output","stateChanageEventCallback","outputs","rawdata","setEventChannel","clear","userConnect","updateOutputList","access","out","onstatechange","setStateChangeEventListener","setOutput","channelNum"],"mappings":"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A;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAID,EA71BD,I;;;;;;;;;;;;;;ACZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I;;;;;;;;;;;SCMgB0L,Q,GAAAA,Q;;AAFhB;;;;;;AAEO,UAASA,QAAT,CAAkBlL,IAAlB,EAAwB;AAC7B,OAAImL,iBAAJ;;AAEA,YAASC,SAAT,CAAmBC,MAAnB,EAA2B;AACzB,SAAIxR,KAAKwR,OAAOC,IAAP,CAAY,CAAZ,CAAT;AACA,SAAI5R,SAAS2R,OAAOE,SAAP,EAAb;AACA,YAAO;AACL,aAAM1R,EADD;AAEL,iBAAUH,MAFL;AAGL,eAAQ2R,OAAOC,IAAP,CAAY5R,MAAZ;AAHH,MAAP;AAKD;;AAED,YAAS8R,SAAT,CAAmBH,MAAnB,EAA2B;AACzB,SAAItU,QAAQ,EAAZ;;AAEAA,WAAM0U,SAAN,GAAkBJ,OAAOK,UAAP,EAAlB;AACAL,YAAOM,kBAAP;AACA,SAAIC,gBAAgBP,OAAOQ,QAAP,EAApB;AACA,SAAI,CAA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","file":"midi.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MIDI\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MIDI\"] = factory();\n\telse\n\t\troot[\"MIDI\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 5244c911caf17485bb78\n **/","import root from './root'\r\nimport './loader'\r\nimport './gm'\r\nimport './player'\r\nimport './plugins'\r\n\r\nwindow.MIDI = root\r\nexport default root\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.js\n **/","class MidiPlayer{\r\n    API = {\r\n        WebMIDI:{\r\n            root:this,\r\n            enabled: true,\r\n            get avaliable(){return this.root.WebAudio != null},\r\n            get api(){return this.root.WebMIDI},\r\n        },\r\n        WebAudio:{\r\n            root:this,\r\n            enabled: true,\r\n            get avaliable(){return this.root.WebAudio != null},\r\n            get api(){return this.root.WebAudio},\r\n        },\r\n        AudioTag:{\r\n            root:this,\r\n            enabled: true,\r\n            get avaliable(){return this.AudioTag != null},\r\n            get api(){return this.root.AudioTag},\r\n            \r\n        }\r\n    }\r\n\r\n    MidiChannelMapping = {}\r\n\r\n    setController = (event, channel, type, value, delay) => {\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            if(api.enabled && api.avaliable){\r\n                api.api.setController(event, channel, type, value, delay)\r\n            }\r\n        }\r\n    }\r\n\r\n    programChange = (event, channel, program, delay)  => { // change patch (instrument)\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            if(api.enabled && api.avaliable){\r\n                api.api.programChange(event, channel, program, delay)\r\n            }\r\n        }\r\n    }\r\n\r\n    pitchBend = (event, channel, program, delay)  => { // pitch bend\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            \r\n            if(api.enabled && api.avaliable){\r\n                api.api.pitchBend(event, channel, program, delay)\r\n            }\r\n        }\r\n    }\r\n\r\n    noteOn = (event,channel, note, velocity, delay)  => {\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            // console.log(api, api.enabled, api.avaliable)\r\n            if(api.enabled && api.avaliable){\r\n                api.api.noteOn(event,channel, note, velocity, delay)\r\n            }\r\n        }\r\n    }\r\n    noteOff = (event, channel, note, delay)  => {\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            if(api.enabled && api.avaliable){\r\n                api.api.noteOff(event, channel, note, delay)\r\n            }\r\n        }\r\n    }\r\n\r\n    stopAllNotes = (delay, lookAhead, stopImmediatelyIfPossible = false)  => {\r\n        for (const apiName in this.API) {\r\n            var api = this.API[apiName];\r\n            //console.log(api, api.enabled, api.avaliable)\r\n            if(api.enabled && api.avaliable){\r\n                api.api.stopAllNotes(delay, lookAhead, stopImmediatelyIfPossible)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default  new MidiPlayer();\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/root.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  root.Plugin : 0.3.4 : 2015-03-26\r\n  ----------------------------------------------------------\r\n  https://github.com/mudcube/root.js\r\n  ----------------------------------------------------------\r\n  Inspired by javax.sound.midi (albeit a super simple version):\r\n    http://docs.oracle.com/javase/6/docs/api/javax/sound/midi/package-summary.html\r\n  ----------------------------------------------------------\r\n  Technologies\r\n  ----------------------------------------------------------\r\n    Web MIDI API - no native support yet (jazzplugin)\r\n    Web Audio API - firefox 25+, chrome 10+, safari 6+, opera 15+\r\n    HTML5 Audio Tag - ie 9+, firefox 3.5+, chrome 4+, safari 4+, opera 9.5+, ios 4+, android 2.3+\r\n  ----------------------------------------------------------\r\n*/\r\n\r\nimport { audioDetect, loadScript, request } from './utils'\r\nimport root from './root'\r\n\r\nroot.Soundfont = {}\r\nroot.DEBUG = true\r\nroot.USE_XHR = true\r\nroot.soundfontUrl = './soundfont/'\r\n\r\n/*\r\n  root.loadPlugin({\r\n    onsuccess: function() { },\r\n    onprogress: function(state, percent) { },\r\n    targetFormat: 'mp3', // optionally can force to use MP3 (for instance on mobile networks)\r\n    instrument: 'acoustic_grand_piano', // or 1 (default)\r\n    instruments: [ 'acoustic_grand_piano', 'acoustic_guitar_nylon' ] // or multiple instruments\r\n  })\r\n*/\r\n\r\nroot.loadPlugin = async function (opts) {\r\n  if (typeof opts === 'function') {\r\n    opts = {onsuccess: opts}\r\n  }\r\n\r\n  root.soundfontUrl = opts.soundfontUrl || root.soundfontUrl\r\n\r\n  // / Detect the best type of audio to use\r\n  audioDetect( async function (supports) {\r\n    var hash = window.location.hash\r\n    var api = ''\r\n    var success = false;\r\n\r\n    //console.log(supports);\r\n\r\n    // / use the most appropriate plugin if not specified\r\n    // if (supports[opts.api]) {\r\n    //   api = opts.api\r\n    // } \r\n    // if (supports[hash.substr(1)]) {\r\n    //   api = hash.substr(1)\r\n    // } \r\n    // if (supports.webmidi) {\r\n    //   api = 'webmidi'\r\n    // } \r\n    // if (window.AudioContext) { // Chrome\r\n    //   api = 'webaudio'\r\n    // } \r\n    // if (window.Audio) { // Firefox\r\n    //   api = 'audiotag'\r\n    // }\r\n\r\n    console.log(\"detect\");\r\n\r\n   // if (connect[api]) {\r\n      // / use audio/ogg when supported\r\n    let audioFormat\r\n    if (opts.targetFormat) {\r\n      audioFormat = opts.targetFormat\r\n    } else { // use best quality\r\n      audioFormat = supports['audio/ogg'] ? 'ogg' : 'mp3'\r\n    }\r\n\r\n    // / load the specified plugin\r\n    root.__api = api\r\n    root.__audioFormat = audioFormat\r\n    root.supports = supports\r\n    root.loadResource(opts)\r\n   // }\r\n\r\n    //connect[root.__api](opts)\r\n    var list = [];\r\n\r\n    if (supports.webmidi) {\r\n      api = 'webmidi'\r\n      list.push(connect['webmidi'](opts));\r\n    } \r\n    if (window.AudioContext) { // Chrome\r\n      api = 'webaudio'\r\n      list.push(connect['webaudio'](opts));\r\n    } \r\n    // if (window.Audio) { // Firefox\r\n    //   api = 'audiotag'\r\n    //   list.push(connect['audiotag'](opts));\r\n    // }\r\n\r\n    for (const item of list) {\r\n      await item;\r\n    }\r\n  })\r\n}\r\n\r\n/*\r\n  root.loadResource({\r\n    onsuccess: function() { },\r\n    onprogress: function(state, percent) { },\r\n    instrument: 'banjo'\r\n  })\r\n*/\r\n\r\nroot.loadResource = function (opts) {\r\n  var instruments = opts.instruments || opts.instrument || 'acoustic_grand_piano'\r\n  // /\r\n  if (typeof instruments !== 'object') {\r\n    if (instruments || instruments === 0) {\r\n      instruments = [instruments]\r\n    } else {\r\n      instruments = []\r\n    }\r\n  }\r\n  // / convert numeric ids into strings\r\n  for (var i = 0; i < instruments.length; i++) {\r\n    var instrument = instruments[i]\r\n    if (instrument === +instrument) { // is numeric\r\n      if (root.GM.byId[instrument]) {\r\n        instruments[i] = root.GM.byId[instrument].id\r\n      }\r\n    }\r\n  }\r\n  // /\r\n  opts.format = root.__audioFormat\r\n  opts.instruments = instruments\r\n  // /\r\n\r\n}\r\n\r\nvar connect = {\r\n  webmidi: function (opts) {\r\n    // cant wait for this to be standardized!\r\n    root.WebMIDI.connect(opts)\r\n  },\r\n  audiotag: function (opts) {\r\n    // works ok, kinda like a drunken tuna fish, across the board\r\n    // http://caniuse.com/audio\r\n    requestQueue(opts, 'AudioTag')\r\n  },\r\n  webaudio: function (opts) {\r\n    // works awesome! safari, chrome and firefox support\r\n    // http://caniuse.com/web-audio\r\n    requestQueue(opts, 'WebAudio')\r\n  }\r\n}\r\n\r\nvar requestQueue = function (opts, context) {\r\n  var audioFormat = opts.format\r\n  var instruments = opts.instruments\r\n  var onprogress = opts.onprogress\r\n  var onerror = opts.onerror\r\n  // /\r\n  var length = instruments.length\r\n  var pending = length\r\n  var waitForEnd = function () {\r\n    if (!--pending) {\r\n      onprogress && onprogress('load', 1.0)\r\n      root[context].connect(opts)\r\n    }\r\n  }\r\n  // /\r\n  for (var i = 0; i < length; i++) {\r\n    var instrumentId = instruments[i]\r\n    if (root.Soundfont[instrumentId]) { // already loaded\r\n      waitForEnd()\r\n    } else { // needs to be requested\r\n      sendRequest(instruments[i], audioFormat, function (evt, progress) {\r\n        var fileProgress = progress / length\r\n        var queueProgress = (length - pending) / length\r\n        onprogress && onprogress('load', fileProgress + queueProgress, instrumentId)\r\n      }, function () {\r\n        waitForEnd()\r\n      }, onerror)\r\n    }\r\n  }\r\n}\r\n\r\nvar sendRequest = function (instrumentId, audioFormat, onprogress, onsuccess, onerror) {\r\n  var soundfontPath = root.soundfontUrl + instrumentId + '-' + audioFormat + '.js'\r\n  if (root.USE_XHR) {\r\n    request({\r\n      url: soundfontPath,\r\n      format: 'text',\r\n      onerror: onerror,\r\n      onprogress: onprogress,\r\n      onsuccess: function (event, responseText) {\r\n        var script = document.createElement('script')\r\n        script.language = 'javascript'\r\n        script.type = 'text/javascript'\r\n        script.text = responseText\r\n        document.body.appendChild(script)\r\n        onsuccess()\r\n      }\r\n    })\r\n  } else {\r\n    loadScript.add({\r\n      url: soundfontPath,\r\n      verify: 'root.Soundfont[\"' + instrumentId + '\"]',\r\n      onerror: onerror,\r\n      onsuccess: function () {\r\n        onsuccess()\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nroot.setDefaultPlugin = function (midi) {\r\n  // for (var key in midi) {\r\n  //   root[key] = midi[key]\r\n  // }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/loader.js\n **/","export * from './audio-detect'\r\nexport * from './load-script'\r\nexport * from './request'\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/index.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  midi.audioDetect : 0.3.2 : 2015-03-26\r\n  ----------------------------------------------------------\r\n  https://github.com/mudcube/midi.js\r\n  ----------------------------------------------------------\r\n  Probably, Maybe, No... Absolutely!\r\n  Test to see what types of <audio> MIME types are playable by the browser.\r\n  ----------------------------------------------------------\r\n*/\r\n\r\nconst supports = {} // object of supported file types\r\nlet pending = 0 // pending file types to process\r\nconst canPlayThrough = function (src) { // check whether format plays through\r\n  pending++\r\n  const body = document.body\r\n  const audio = new window.Audio()\r\n  const mime = src.split(';')[0]\r\n  audio.id = 'audio'\r\n  audio.setAttribute('preload', 'auto')\r\n  audio.setAttribute('audiobuffer', true)\r\n  audio.addEventListener('error', function () {\r\n    body.removeChild(audio)\r\n    supports[mime] = false\r\n    pending--\r\n  }, false)\r\n  audio.addEventListener('canplaythrough', function () {\r\n    body.removeChild(audio)\r\n    supports[mime] = true\r\n    pending--\r\n  }, false)\r\n  audio.src = 'data:' + src\r\n  body.appendChild(audio)\r\n}\r\n\r\nexport const audioDetect = function (onsuccess) {\r\n  // / detect jazz-midi plugin\r\n  if (navigator.requestMIDIAccess) {\r\n    const isNative = Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf('[native code]')\r\n    if (isNative) { // has native midiapi support\r\n      supports['webmidi'] = true\r\n    } else { // check for jazz plugin midiapi support\r\n      for (let n = 0; navigator.plugins.length > n; n++) {\r\n        const plugin = navigator.plugins[n]\r\n        if (plugin.name.indexOf('Jazz-Plugin') >= 0) {\r\n          supports['webmidi'] = true\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // / check whether <audio> tag is supported\r\n  if (typeof (window.Audio) === 'undefined') {\r\n    return onsuccess({})\r\n  } else {\r\n    supports['audiotag'] = true\r\n  }\r\n\r\n  // / check for webaudio api support\r\n  if (window.AudioContext || window.webkitAudioContext) {\r\n    supports['webaudio'] = true\r\n  }\r\n\r\n  // / check whether canPlayType is supported\r\n  const audio = new window.Audio()\r\n  if (typeof (audio.canPlayType) === 'undefined') {\r\n    return onsuccess(supports)\r\n  }\r\n\r\n  // / see what we can learn from the browser\r\n  let vorbis = audio.canPlayType('audio/ogg; codecs=\"vorbis\"')\r\n  vorbis = (vorbis === 'probably' || vorbis === 'maybe')\r\n  let mpeg = audio.canPlayType('audio/mpeg')\r\n  mpeg = (mpeg === 'probably' || mpeg === 'maybe')\r\n  // maybe nothing is supported\r\n  if (!vorbis && !mpeg) {\r\n    onsuccess(supports)\r\n    return\r\n  }\r\n\r\n  // / or maybe something is supported\r\n  if (vorbis) canPlayThrough('audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=')\r\n  if (mpeg) canPlayThrough('audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq')\r\n\r\n  // / lets find out!\r\n  const time = (new Date()).getTime()\r\n  let interval = window.setInterval(function () {\r\n    const now = (new Date()).getTime()\r\n    const maxExecution = now - time > 5000\r\n    if (!pending || maxExecution) {\r\n      window.clearInterval(interval)\r\n      onsuccess(supports)\r\n    }\r\n  }, 1)\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/audio-detect.js\n **/","/*\r\n  -----------------------------------------------------------\r\n  loadScript.js : 0.1.4 : 2014/02/12 : http://mudcu.be\r\n  -----------------------------------------------------------\r\n  Copyright 2011-2014 Mudcube. All rights reserved.\r\n  -----------------------------------------------------------\r\n  /// No verification\r\n  loadScript.add(\"../js/jszip/jszip.js\")\r\n  /// Strict loading order and verification.\r\n  loadScript.add({\r\n    strictOrder: true,\r\n    urls: [\r\n      {\r\n        url: \"../js/jszip/jszip.js\",\r\n        verify: \"JSZip\",\r\n        onsuccess: function() {\r\n          console.log(1)\r\n        }\r\n      },\r\n      {\r\n        url: \"../inc/downloadify/js/swfobject.js\",\r\n        verify: \"swfobject\",\r\n        onsuccess: function() {\r\n          console.log(2)\r\n        }\r\n      }\r\n    ],\r\n    onsuccess: function() {\r\n      console.log(3)\r\n    }\r\n  })\r\n  /// Just verification.\r\n  loadScript.add({\r\n    url: \"../js/jszip/jszip.js\",\r\n    verify: \"JSZip\",\r\n    onsuccess: function() {\r\n      console.log(1)\r\n    }\r\n  })\r\n*/\r\n\r\nconst _globalExists = function (path, root) {\r\n  try {\r\n    path = path.split('\"').join('').split(\"'\").join('').split(']').join('').split('[').join('.')\r\n    var parts = path.split('.')\r\n    var length = parts.length\r\n    var object = root || window\r\n    for (var n = 0; n < length; n++) {\r\n      var key = parts[n]\r\n      if (object[key] == null) {\r\n        return false\r\n      } else { //\r\n        object = object[key]\r\n      }\r\n    }\r\n    return true\r\n  } catch (e) {\r\n    return false\r\n  }\r\n}\r\n\r\nconst LoadScript = function () {\r\n  this.loaded = {}\r\n  this.loading = {}\r\n  return this\r\n}\r\n\r\nLoadScript.prototype.add = function (config) {\r\n  var that = this\r\n  if (typeof (config) === 'string') {\r\n    config = { url: config }\r\n  }\r\n  var urls = config.urls\r\n  if (typeof (urls) === 'undefined') {\r\n    urls = [{\r\n      url: config.url,\r\n      verify: config.verify\r\n    }]\r\n  }\r\n  // / adding the elements to the head\r\n  var doc = document.getElementsByTagName('head')[0]\r\n  // /\r\n  var testElement = function (element, test) {\r\n    if (that.loaded[element.url]) return\r\n    if (test && _globalExists(test) === false) return\r\n    that.loaded[element.url] = true\r\n    //\r\n    if (that.loading[element.url]) that.loading[element.url]()\r\n    delete that.loading[element.url]\r\n    //\r\n    if (element.onsuccess) element.onsuccess()\r\n    if (typeof (getNext) !== 'undefined') getNext()\r\n  }\r\n  // /\r\n  var hasError = false\r\n  var batchTest = []\r\n  var addElement = function (element) {\r\n    if (typeof (element) === 'string') {\r\n      element = {\r\n        url: element,\r\n        verify: config.verify\r\n      }\r\n    }\r\n    if (/([\\w\\d.\\[\\]'\"])$/.test(element.verify)) { // check whether its a variable reference\r\n      var verify = element.test = element.verify\r\n      if (typeof (verify) === 'object') {\r\n        for (var n = 0; n < verify.length; n++) {\r\n          batchTest.push(verify[n])\r\n        }\r\n      } else {\r\n        batchTest.push(verify)\r\n      }\r\n    }\r\n    if (that.loaded[element.url]) return\r\n    var script = document.createElement('script')\r\n    script.onreadystatechange = function () {\r\n      if (this.readyState !== 'loaded' && this.readyState !== 'complete') return\r\n      testElement(element)\r\n    }\r\n    script.onload = function () {\r\n      testElement(element)\r\n    }\r\n    script.onerror = function () {\r\n      hasError = true\r\n      delete that.loading[element.url]\r\n      if (typeof (element.test) === 'object') {\r\n        for (let key in element.test) {\r\n          removeTest(element.test[key])\r\n        }\r\n      } else {\r\n        removeTest(element.test)\r\n      }\r\n    }\r\n    script.setAttribute('type', 'text/javascript')\r\n    script.setAttribute('src', element.url)\r\n    doc.appendChild(script)\r\n    that.loading[element.url] = function () {}\r\n  }\r\n  // / checking to see whether everything loaded properly\r\n  var removeTest = function (test) {\r\n    var ret = []\r\n    for (var n = 0; n < batchTest.length; n++) {\r\n      if (batchTest[n] === test) continue\r\n      ret.push(batchTest[n])\r\n    }\r\n    batchTest = ret\r\n  }\r\n  var onLoad = function (element) {\r\n    if (element) {\r\n      testElement(element, element.test)\r\n    } else {\r\n      for (let n = 0; n < urls.length; n++) {\r\n        testElement(urls[n], urls[n].test)\r\n      }\r\n    }\r\n    var istrue = true\r\n    for (let n = 0; n < batchTest.length; n++) {\r\n      if (_globalExists(batchTest[n]) === false) {\r\n        istrue = false\r\n      }\r\n    }\r\n    if (!config.strictOrder && istrue) { // finished loading all the requested scripts\r\n      if (hasError) {\r\n        if (config.error) {\r\n          config.error()\r\n        }\r\n      } else if (config.onsuccess) {\r\n        config.onsuccess()\r\n      }\r\n    } else { // keep calling back the function\r\n      setTimeout(function () { // - should get slower over time?\r\n        onLoad(element)\r\n      }, 10)\r\n    }\r\n  }\r\n  // / loading methods;  strict ordering or loose ordering\r\n  if (config.strictOrder) {\r\n    var ID = -1\r\n    var getNext = function () {\r\n      ID++\r\n      if (!urls[ID]) { // all elements are loaded\r\n        if (hasError) {\r\n          if (config.error) {\r\n            config.error()\r\n          }\r\n        } else if (config.onsuccess) {\r\n          config.onsuccess()\r\n        }\r\n      } else { // loading new script\r\n        var element = urls[ID]\r\n        var url = element.url\r\n        if (that.loading[url]) { // already loading from another call (attach to event)\r\n          that.loading[url] = function () {\r\n            if (element.onsuccess) element.onsuccess()\r\n            getNext()\r\n          }\r\n        } else if (!that.loaded[url]) { // create script element\r\n          addElement(element)\r\n          onLoad(element)\r\n        } else { // it's already been successfully loaded\r\n          getNext()\r\n        }\r\n      }\r\n    }\r\n    getNext()\r\n  } else { // loose ordering\r\n    for (let ID = 0; ID < urls.length; ID++) {\r\n      addElement(urls[ID])\r\n      onLoad(urls[ID])\r\n    }\r\n  }\r\n}\r\n\r\nexport const loadScript = new LoadScript()\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/load-script.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  Request : 0.1.1 : 2015-03-26\r\n  ----------------------------------------------------------\r\n  request({\r\n    url: './dir/something.extension',\r\n    data: 'test!',\r\n    format: 'text', // text | xml | json | binary\r\n    responseType: 'text', // arraybuffer | blob | document | json | text\r\n    headers: {},\r\n    withCredentials: true, // true | false\r\n    ///\r\n    onerror: function(evt, percent) {\r\n      console.log(evt)\r\n    },\r\n    onsuccess: function(evt, responseText) {\r\n      console.log(responseText)\r\n    },\r\n    onprogress: function(evt, percent) {\r\n      percent = Math.round(percent * 100)\r\n      loader.create('thread', 'loading... ', percent)\r\n    }\r\n  })\r\n*/\r\n\r\nexport function request (opts, onsuccess, onerror, onprogress) {\r\n  if (typeof opts === 'string') opts = {url: opts}\r\n  const data = opts.data\r\n  const url = opts.url\r\n  const method = opts.method || (opts.data ? 'POST' : 'GET')\r\n  const format = opts.format\r\n  const headers = opts.headers\r\n  const responseType = opts.responseType\r\n  const withCredentials = opts.withCredentials || false\r\n  const xhr = new window.XMLHttpRequest()\r\n  onsuccess = onsuccess || opts.onsuccess\r\n  onerror = onerror || opts.onerror\r\n  onprogress = onprogress || opts.onprogress\r\n  xhr.open(method, url, true)\r\n  if (headers) {\r\n    for (var type in headers) {\r\n      xhr.setRequestHeader(type, headers[type])\r\n    }\r\n  } else if (data) { // set the default headers for POST\r\n    xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')\r\n  }\r\n  if (format === 'binary') { // - default to responseType=\"blob\" when supported\r\n    if (xhr.overrideMimeType) {\r\n      xhr.overrideMimeType('text/plain; charset=x-user-defined')\r\n    }\r\n  }\r\n  if (responseType) {\r\n    xhr.responseType = responseType\r\n  }\r\n  if (withCredentials) {\r\n    xhr.withCredentials = 'true'\r\n  }\r\n  if (onerror && 'onerror' in xhr) {\r\n    xhr.onerror = onerror\r\n  }\r\n  if (onprogress && xhr.upload && 'onprogress' in xhr.upload) {\r\n    if (data) {\r\n      xhr.upload.onprogress = function (evt) {\r\n        onprogress.call(xhr, evt, evt.loaded / evt.total)\r\n      }\r\n    } else {\r\n      xhr.addEventListener('progress', function (evt) {\r\n        var totalBytes = 0\r\n        if (evt.lengthComputable) {\r\n          totalBytes = evt.total\r\n        } else if (xhr.totalBytes) {\r\n          totalBytes = xhr.totalBytes\r\n        } else {\r\n          // var rawBytes = parseInt(xhr.getResponseHeader('Content-Length-Raw'))\r\n          // if (isFinite(rawBytes)) {\r\n          //   xhr.totalBytes = totalBytes = rawBytes\r\n          // } else {\r\n            return\r\n          //}\r\n        }\r\n        onprogress.call(xhr, evt, evt.loaded / totalBytes)\r\n      })\r\n    }\r\n  }\r\n  // /\r\n  xhr.onreadystatechange = function (evt) {\r\n    if (xhr.readyState === 4) { // The request is complete\r\n      if (xhr.status === 200 || // Response OK\r\n        xhr.status === 304 || // Not Modified\r\n        xhr.status === 308 // Permanent Redirect\r\n      ) {\r\n        if (onsuccess) {\r\n          var res\r\n          if (format === 'xml') {\r\n            res = evt.target.responseXML\r\n          } else if (format === 'text') {\r\n            res = evt.target.responseText\r\n          } else if (format === 'json') {\r\n            try {\r\n              res = JSON.parse(evt.target.response)\r\n            } catch (err) {\r\n              onerror && onerror.call(xhr, evt)\r\n            }\r\n          }\r\n          onsuccess.call(xhr, evt, res)\r\n        }\r\n      } else {\r\n        onerror && onerror.call(xhr, evt)\r\n      }\r\n    }\r\n  }\r\n  xhr.send(data)\r\n  return xhr\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/request.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  GeneralMIDI\r\n  ----------------------------------------------------------\r\n*/\r\n\r\nimport root from './root'\r\n\r\nroot.GM = (function (map) {\r\n  const clean = function (name) {\r\n    return name.replace(/[^a-z0-9 ]/gi, '').replace(/[ ]/g, '_').toLowerCase()\r\n  }\r\n  const res = {\r\n    byName: { },\r\n    byId: { },\r\n    byCategory: { }\r\n  }\r\n  for (let key in map) {\r\n    var list = map[key]\r\n    for (var n = 0, length = list.length; n < length; n++) {\r\n      var instrument = list[n]\r\n      if (!instrument) continue\r\n      var num = parseInt(instrument.substr(0, instrument.indexOf(' ')), 10)\r\n      instrument = instrument.replace(num + ' ', '')\r\n      res.byId[--num] =\r\n        res.byName[clean(instrument)] =\r\n          res.byCategory[clean(key)] = {\r\n            id: clean(instrument),\r\n            instrument: instrument,\r\n            number: num,\r\n            category: key\r\n          }\r\n    }\r\n  }\r\n  return res\r\n})({\r\n  'Piano': ['1 Acoustic Grand Piano', '2 Bright Acoustic Piano', '3 Electric Grand Piano', '4 Honky-tonk Piano', '5 Electric Piano 1', '6 Electric Piano 2', '7 Harpsichord', '8 Clavinet'],\r\n  'Chromatic Percussion': ['9 Celesta', '10 Glockenspiel', '11 Music Box', '12 Vibraphone', '13 Marimba', '14 Xylophone', '15 Tubular Bells', '16 Dulcimer'],\r\n  'Organ': ['17 Drawbar Organ', '18 Percussive Organ', '19 Rock Organ', '20 Church Organ', '21 Reed Organ', '22 Accordion', '23 Harmonica', '24 Tango Accordion'],\r\n  'Guitar': ['25 Acoustic Guitar (nylon)', '26 Acoustic Guitar (steel)', '27 Electric Guitar (jazz)', '28 Electric Guitar (clean)', '29 Electric Guitar (muted)', '30 Overdriven Guitar', '31 Distortion Guitar', '32 Guitar Harmonics'],\r\n  'Bass': ['33 Acoustic Bass', '34 Electric Bass (finger)', '35 Electric Bass (pick)', '36 Fretless Bass', '37 Slap Bass 1', '38 Slap Bass 2', '39 Synth Bass 1', '40 Synth Bass 2'],\r\n  'Strings': ['41 Violin', '42 Viola', '43 Cello', '44 Contrabass', '45 Tremolo Strings', '46 Pizzicato Strings', '47 Orchestral Harp', '48 Timpani'],\r\n  'Ensemble': ['49 String Ensemble 1', '50 String Ensemble 2', '51 Synth Strings 1', '52 Synth Strings 2', '53 Choir Aahs', '54 Voice Oohs', '55 Synth Choir', '56 Orchestra Hit'],\r\n  'Brass': ['57 Trumpet', '58 Trombone', '59 Tuba', '60 Muted Trumpet', '61 French Horn', '62 Brass Section', '63 Synth Brass 1', '64 Synth Brass 2'],\r\n  'Reed': ['65 Soprano Sax', '66 Alto Sax', '67 Tenor Sax', '68 Baritone Sax', '69 Oboe', '70 English Horn', '71 Bassoon', '72 Clarinet'],\r\n  'Pipe': ['73 Piccolo', '74 Flute', '75 Recorder', '76 Pan Flute', '77 Blown Bottle', '78 Shakuhachi', '79 Whistle', '80 Ocarina'],\r\n  'Synth Lead': ['81 Lead 1 (square)', '82 Lead 2 (sawtooth)', '83 Lead 3 (calliope)', '84 Lead 4 (chiff)', '85 Lead 5 (charang)', '86 Lead 6 (voice)', '87 Lead 7 (fifths)', '88 Lead 8 (bass + lead)'],\r\n  'Synth Pad': ['89 Pad 1 (new age)', '90 Pad 2 (warm)', '91 Pad 3 (polysynth)', '92 Pad 4 (choir)', '93 Pad 5 (bowed)', '94 Pad 6 (metallic)', '95 Pad 7 (halo)', '96 Pad 8 (sweep)'],\r\n  'Synth Effects': ['97 FX 1 (rain)', '98 FX 2 (soundtrack)', '99 FX 3 (crystal)', '100 FX 4 (atmosphere)', '101 FX 5 (brightness)', '102 FX 6 (goblins)', '103 FX 7 (echoes)', '104 FX 8 (sci-fi)'],\r\n  'Ethnic': ['105 Sitar', '106 Banjo', '107 Shamisen', '108 Koto', '109 Kalimba', '110 Bagpipe', '111 Fiddle', '112 Shanai'],\r\n  'Percussive': ['113 Tinkle Bell', '114 Agogo', '115 Steel Drums', '116 Woodblock', '117 Taiko Drum', '118 Melodic Tom', '119 Synth Drum'],\r\n  'Sound effects': ['120 Reverse Cymbal', '121 Guitar Fret Noise', '122 Breath Noise', '123 Seashore', '124 Bird Tweet', '125 Telephone Ring', '126 Helicopter', '127 Applause', '128 Gunshot']\r\n})\r\n\r\n/* get/setInstrument\r\n--------------------------------------------------- */\r\nroot.getInstrument = function (channelId) {\r\n  var channel = root.channels[channelId]\r\n  return channel && channel.instrument\r\n}\r\n\r\nroot.setInstrument = function (channelId, program, delay) {\r\n  var channel = root.channels[channelId]\r\n  if (delay) {\r\n    return setTimeout(function () {\r\n      channel.instrument = program\r\n    }, delay)\r\n  } else {\r\n    channel.instrument = program\r\n  }\r\n}\r\n\r\n/* get/setMono\r\n--------------------------------------------------- */\r\nroot.getMono = function (channelId) {\r\n  var channel = root.channels[channelId]\r\n  return channel && channel.mono\r\n}\r\n\r\nroot.setMono = function (channelId, truthy, delay) {\r\n  var channel = root.channels[channelId]\r\n  if (delay) {\r\n    return setTimeout(function () {\r\n      channel.mono = truthy\r\n    }, delay)\r\n  } else {\r\n    channel.mono = truthy\r\n  }\r\n}\r\n\r\n/* get/setOmni\r\n--------------------------------------------------- */\r\nroot.getOmni = function (channelId) {\r\n  var channel = root.channels[channelId]\r\n  return channel && channel.omni\r\n}\r\n\r\nroot.setOmni = function (channelId, truthy, delay) {\r\n  var channel = root.channels[channelId]\r\n  if (delay) {\r\n    return setTimeout(function () {\r\n      channel.omni = truthy\r\n    }, delay)\r\n  } else {\r\n    channel.omni = truthy\r\n  }\r\n}\r\n\r\n/* get/setSolo\r\n--------------------------------------------------- */\r\nroot.getSolo = function (channelId) {\r\n  var channel = root.channels[channelId]\r\n  return channel && channel.solo\r\n}\r\n\r\nroot.setSolo = function (channelId, truthy, delay) {\r\n  var channel = root.channels[channelId]\r\n  if (delay) {\r\n    return setTimeout(function () {\r\n      channel.solo = truthy\r\n    }, delay)\r\n  } else {\r\n    channel.solo = truthy\r\n  }\r\n}\r\n\r\n/* channels\r\n--------------------------------------------------- */\r\nroot.channels = (function () { // 0 - 15 channels\r\n  var channels = {}\r\n  for (let i = 0; i < 16; i++) {\r\n    channels[i] = { // default values\r\n      id: i,\r\n      instrument: i,\r\n      pitchBend: 0,\r\n      mute: false,\r\n      mono: false,\r\n      omni: false,\r\n      solo: false\r\n    }\r\n  }\r\n  channels['metronome'] = { // metronome\r\n    id: 'metronome',\r\n    instrument: 114,\r\n    pitchBend: 0,\r\n    mute: false,\r\n    mono: false,\r\n    omni: false,\r\n    solo: false\r\n  }\r\n  \r\n  return channels\r\n})()\r\n\r\n/* note conversions\r\n--------------------------------------------------- */\r\nroot.keyToNote = {} // C8  == 108\r\nroot.noteToKey = {} // 108 ==  C8\r\n\r\n~(function () {\r\n  var A0 = 0x15 // first note\r\n  var C8 = 0x6C // last note\r\n  var number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B']\r\n  for (let n = A0; n <= C8; n++) {\r\n    var octave = (n - 12) / 12 >> 0\r\n    var name = number2key[n % 12] + octave\r\n    root.keyToNote[name] = n\r\n    root.noteToKey[n] = name\r\n  }\r\n})()\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/gm.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  midi.Player : 0.3.1 : 2015-03-26\r\n  ----------------------------------------------------------\r\n  https://github.com/mudcube/midi.js\r\n  ----------------------------------------------------------\r\n*/\r\n\r\nimport { MidiFile, Replayer } from './jasmid'\r\nimport root from './root'\r\nimport { setPreciseInterval, clearPreciseInterval } from 'precise-interval';\r\n\r\n(function () {\r\n  root.Player = {}\r\n  const player = root.Player\r\n  player.currentTime = 0\r\n  player.endTime = 0\r\n  player.restart = 0\r\n  player.playing = false\r\n  player.timeWarp = 1\r\n  player.startDelay = 0\r\n  player.BPM = 120\r\n  player.TimeSignitures = null\r\n  player.OverrideProgramChanges = false\r\n  player.playingStartTime = 0;\r\n  player.ctxStartTime = 0;\r\n  player.lastCallbackTime = 0;\r\n  player.minLookAheadTime = 0.5;\r\n  player.useMetronome = false;\r\n  player.queuedTime  = 0//\r\n  player.currentProcessedEventTime = 0//\r\n\r\n  var noteRegistrar = {} // get event for requested note\r\n  var noteOffRegistrar = {}\r\n  var onMidiEvent // listener\r\n\r\n\r\n  // var data = {\r\n  //   channel: channel,\r\n  //   note: note,\r\n  //   now: currentTime,\r\n  //   end: player.endTime,\r\n  //   message: message,\r\n  //   velocity: velocity,\r\n  //   rawData: eventObj.rawData\r\n  // }\r\n  player.start = player.resume = function (onsuccess) {\r\n    if (player.currentTime < -1) {\r\n      player.currentTime = -1\r\n    }\r\n\r\n    player.insideLoop = false;\r\n    // if (player.loopStart !== undefined) {\r\n    //   if(player.currentTime < player.loopStart * 1000 || player.currentTime > player.loopEnd * 1000){\r\n    //     player.currentTime = player.loopStart * 1000;\r\n    //   }\r\n    // }\r\n    //startAudio(player.currentTime, null, onsuccess)\r\n    if(player.playing){\r\n      stopAudio()\r\n    }\r\n    player.scheduleLoop();\r\n  }\r\n\r\n  player.startAudio = (startTime, ctxDelay = 0) => {\r\n    player.playingStartTime = player.currentTime = startTime;\r\n    for (const api in root.API) {\r\n      if (root.API[api].avaliable) {\r\n        root.API[api].api.recordCtxStartTime(ctxDelay);\r\n      }\r\n    }\r\n    for (const channelId in root.channels) {\r\n      let channel = root.channels[channelId];\r\n      let status = 0xc0 & channel;\r\n      root.programChange(\r\n        {\r\n          type: 'channel',\r\n          channel: channelId,\r\n          subtype: 'programChange',\r\n          programNumber: channel.instrument,\r\n          rawData:[status, channel.instrument]\r\n        },\r\n        channelId, channel.instrument, 0\r\n      )\r\n    }\r\n    \r\n    var ctx = player.getContext();\r\n    player.ctxStartTime = ctx.currentTime + ctxDelay;\r\n   \r\n    player.eventPosition = 0;\r\n        //if (!fromCache) {\r\n    //if (typeof player.currentProcessedEventTime === 'undefined') {\r\n    player.currentProcessedEventTime = 0\r\n    console.log(player.restart, player.currentProcessedEventTime, startTime)\r\n    //}\r\n    // /stopAudio()\r\n    player.playing = true\r\n    player.data = player.replayer.getData()\r\n    player.endTime = getLength()\r\n    //}\r\n    player.queuedTime = player.currentTime;\r\n    player.eventPosition = 0;\r\n  }\r\n\r\n  var stopAudio = function () {\r\n    player.playing = false\r\n    player.restart += player.getDisplayedAudioContextPlaytime();\r\n\r\n    // stop the audio, and intervals\r\n    // while (eventQueue.length) {\r\n    //   let o = eventQueue.pop()\r\n    //   window.clearInterval(o.interval)\r\n    //   if (!o.source) continue // is not webaudio\r\n    //   if (typeof (o.source) === 'number') {\r\n    //     window.clearTimeout(o.source)\r\n    //   } else { // webaudio\r\n    //     o.source.disconnect(0)\r\n    //   }\r\n    // }\r\n    var delay = ( (player.currentProcessedEventTime - player.playingStartTime + player.startDelay) / 1000);\r\n    // run callback to cancel any notes still playing\r\n    for (var key in noteRegistrar) {\r\n      let o = noteRegistrar[key]\r\n      //console.log(o, \"off\");\r\n      //root.noteOff(o, o.channel, o.note, 0);\r\n      if (noteRegistrar[key].message === 144 && onMidiEvent) {\r\n        const endPlaybackMidiData = [128 ,o.note, o.velocity]\r\n        let event = {\r\n          channel: o.channel,\r\n          note: o.note,\r\n          now: o.now,\r\n          end: o.end,\r\n          message: 128,\r\n          velocity: o.velocity,\r\n          rawData: endPlaybackMidiData\r\n        }\r\n        onMidiEvent(event);\r\n        root.noteOff(event, o.channel, o.note, delay);\r\n      }\r\n      \r\n    }\r\n\r\n\r\n    if(root.stopAllNotes){\r\n      root.stopAllNotes(delay, player.minLookAheadTime, true);\r\n    }\r\n\r\n    clearPreciseInterval(loopHandler);\r\n    // reset noteRegistrar\r\n    noteRegistrar = {}\r\n  }\r\n\r\n  player.getAudioContextPlaytime = function () {\r\n    let ctx = player.getContext();\r\n    var ctxTime = ctx == null ? window.performance.now() / 1000 : ctx.currentTime;\r\n    return ctxTime - player.ctxStartTime + player.playingStartTime / 1000;\r\n  }\r\n\r\n  player.getDisplayedAudioContextPlaytime = function () {\r\n    let time = player.getAudioContextPlaytime();\r\n    if(player.insideLoop){\r\n      if(player.loopStart !== undefined && player.loopEnd > player.loopStart){\r\n        let loopDuration = player.loopEnd - player.loopStart;\r\n        while(time < player.loopStart){\r\n          time += loopDuration;\r\n        }\r\n        \r\n        if(time >= player.loopEnd){\r\n          time = player.loopStart + time % loopDuration;\r\n        }\r\n      }\r\n    }\r\n    return time;\r\n  }\r\n\r\n  player.pause = function () {\r\n    var tmp = player.restart\r\n    stopAudio()\r\n    player.restart = tmp\r\n  }\r\n\r\n  player.stop = function () {\r\n    stopAudio()\r\n    player.restart = 0\r\n    player.currentTime = 0\r\n  }\r\n\r\n  player.addListener = function (onsuccess) {\r\n    onMidiEvent = onsuccess\r\n  }\r\n\r\n  player.removeListener = function () {\r\n    onMidiEvent = undefined\r\n  }\r\n\r\n  player.setOnLoopRestartedListener = function (onLoopRestarted) {\r\n    player.onLoopRestarted = onLoopRestarted\r\n  }\r\n\r\n  player.removeOnLoopRestartedListener = function () {\r\n    player.onLoopRestarted = undefined\r\n  }\r\n\r\n  player.setLoop = function (start, end) {\r\n    player.loopStart = start;\r\n    player.loopEnd = end;\r\n    console.log(start, end)\r\n    console.trace()\r\n  }\r\n\r\n  player.cancelLoop = function () {\r\n    player.loopStart = undefined;\r\n    player.loopEnd = undefined;\r\n    //console.log(\"cancelLoop\")\r\n  }\r\n\r\n  player.getContext = function () {\r\n    if (root.API.WebAudio.enabled && root.API.WebAudio.avaliable && root.WebAudio.getContext()) {\r\n      return root.WebAudio.getContext() \r\n    } else {\r\n      return { get currentTime(){return window.performance.now() / 1000}}\r\n    }\r\n    //return player.ctx\r\n  }\r\n\r\n  var getLength = function () {\r\n    var data = player.data\r\n    var length = data.length\r\n    var totalTime = 0.5\r\n    for (var n = 0; n < length; n++) {\r\n      totalTime += data[n][1]\r\n    }\r\n    return totalTime\r\n  }\r\n\r\n  var loopHandler;\r\n  player.scheduleLoop = function() {\r\n\r\n    if (!player.replayer) {\r\n      return\r\n    }\r\n      \r\n    player.startAudio(player.currentTime);\r\n\r\n    let lastLoopTime = player.currentTime;\r\n\r\n    let hasLooped = false\r\n\r\n    //console.log(player.data);\r\n\r\n    loopHandler = setPreciseInterval(function () {\r\n      if (player.queuedTime < player.endTime) { // grab next sequence\r\n        // /\r\n        var note\r\n        var offset = 0\r\n        var messages = 0\r\n        var data = player.data\r\n        var length = data.length\r\n\r\n        var dt =  player.currentTime - lastLoopTime;\r\n        lastLoopTime = player.currentTime;\r\n        player.currentTime = player.getAudioContextPlaytime() * 1000;\r\n\r\n        \r\n        //console.log(\"========\", player.currentProcessedEventTime, player.queuedTime, \"===========\");\r\n\r\n        for (var n = player.eventPosition; n < length; n++) {\r\n          var obj = data[n];\r\n          \r\n          //console.log(\"-\", obj, ( player.queuedTime / 1000) - player.minLookAheadTime, player.getAudioContextPlaytime());\r\n          //stop queueing if look ahead is exceeded\r\n          if ((player.queuedTime / 1000) - player.minLookAheadTime > ( player.getAudioContextPlaytime())){\r\n              break;\r\n          }\r\n\r\n         \r\n\r\n          //move currentEvent time and event position, include events before playback begin time\r\n          player.currentProcessedEventTime += obj[1]\r\n          \r\n          player.eventPosition += 1;\r\n\r\n          // var tooEarly = player.currentProcessedEventTime < player.queuedTime;\r\n          // console.log(n, player.currentProcessedEventTime, player.queuedTime, obj, player.currentProcessedEventTime + obj[1], tooEarly);\r\n\r\n          // if (tooEarly) { // + obj[1]\r\n          //   console.log(n, player.currentProcessedEventTime, player.queuedTime, obj, player.currentProcessedEventTime + obj[1], tooEarly)\r\n          //   continue;\r\n          // }\r\n\r\n          if(player.currentProcessedEventTime < player.queuedTime){\r\n            continue\r\n          }\r\n\r\n          // if (player.currentProcessedEventTime < player.playingStartTime) {\r\n          //   continue;\r\n          // }\r\n\r\n\r\n          // console.log(obj[0], \"ok\");\r\n\r\n          //move queue time if we start starting to process new incoming events\r\n          //player.queuedTime += obj[1]\r\n\r\n          player.queuedTime = player.currentProcessedEventTime\r\n\r\n          if(player.loopEnd != undefined){\r\n            let ctxTime = player.getAudioContextPlaytime()\r\n            if(ctxTime < player.loopEnd && ctxTime > player.loopStart){\r\n              player.insideLoop = true\r\n            }\r\n          }\r\n\r\n          //goes back to loop start when loop end is exceeded\r\n          if (player.insideLoop && player.loopEnd != undefined){\r\n            if(player.queuedTime >= player.loopEnd * 1000 || player.queuedTime < player.loopStart * 1000){\r\n              const delay = player.queuedTime / 1000 - player.getAudioContextPlaytime();\r\n              const stopNoteDelay = (player.loopEnd * 1000 - player.playingStartTime + player.startDelay) / 1000\r\n              root.stopAllNotes(stopNoteDelay, 0)\r\n\r\n              noteOffRegistrar[\"stopAllNotes\"] = {\r\n                now: player.queuedTime,\r\n                loopStart: player.loopStart * 1000,\r\n                loopEnd: player.loopEnd * 1000,\r\n                ctxTime: player.ctxStartTime + delay,\r\n              }\r\n\r\n              //console.log(\"before looped\", delay, player.queuedTime, player.loopStart * 1000, player.playingStartTime)\r\n\r\n              //console.log(player.getAudioContextPlaytime(), player.queuedTime, \"loop\", player.loopStart * 1000, player.loopEnd * 1000, delay)\r\n              player.startAudio(player.loopStart * 1000, delay);\r\n              hasLooped  = true\r\n\r\n              if(player.onLoopRestarted){\r\n                player.onLoopRestarted.call(root)\r\n              }\r\n\r\n              //console.log(\"LOOPED\", delay, player.queuedTime, player.loopStart * 1000, player.playingStartTime)\r\n\r\n              break;\r\n            }\r\n          }\r\n\r\n          if(obj[0].type == 'metronomeEvent'){\r\n            if(player.useMetronome){\r\n              var delay = ((player.currentProcessedEventTime - player.playingStartTime + player.startDelay) / 1000);\r\n              if(obj[0].metronomeEventsType == \"light\"){\r\n                root.noteOn({}, 'metronome', 100, 60, delay);\r\n              }\r\n              else{\r\n                root.noteOn({}, 'metronome', 88, 110, delay);\r\n              }\r\n            }\r\n            messages++\r\n            continue;\r\n          }\r\n          \r\n          //handle or queue the event\r\n          var event = obj[0].event;\r\n          if (event.type !== 'channel') {\r\n            continue;\r\n          }\r\n\r\n          var channelId = event.channel\r\n          var channel = root.channels[channelId]\r\n          var delay = ( (player.currentProcessedEventTime - player.playingStartTime + player.startDelay) / 1000);\r\n\r\n          //console.log(\"-\", obj[0].event.channel, obj[1], event.subtype, delay);\r\n          \r\n\r\n          //console.log(ctx.currentTime, player.ctxStartTime, player.currentProcessedEventTime, foffset);\r\n         //console.log(\"event scheduled\", obj, delay);\r\n\r\n          switch (event.subtype) {\r\n            case 'controller':\r\n              root.setController(event, channelId, event.controllerType, event.value, delay)\r\n              break\r\n            case 'programChange':\r\n              if(!player.OverrideProgramChanges){\r\n                root.programChange(event, channelId, event.programNumber, delay)\r\n              }\r\n              break\r\n            case 'pitchBend':\r\n              root.pitchBend(event, channelId, event.value, delay)\r\n              break\r\n            case 'noteOn':\r\n              if (channel.mute) break\r\n              note = event.noteNumber + (player.MIDIOffset || 0)\r\n              event.rawData[1] = note\r\n              root.noteOn(event, channelId, note, event.velocity, delay);\r\n              var key = channelId + \" \" + note + \" \" + delay;\r\n              noteRegistrar[key] = {\r\n                  channel: channelId,\r\n                  note: note,\r\n                  now: player.currentProcessedEventTime,\r\n                  ctxTime: player.ctxStartTime + delay,\r\n                  end: player.endTime,\r\n                  message: 144,\r\n                  velocity: event.velocity,\r\n                  rawData: event.rawData,\r\n                  track: event.track,\r\n              }\r\n              messages++\r\n              break\r\n            case 'noteOff':\r\n              //if (channel.mute) break\r\n              note = event.noteNumber + (player.MIDIOffset || 0)\r\n              event.rawData[1] = note\r\n              root.noteOff(event, channelId, note, delay);\r\n              var key = channelId + \" \" + note + \" \" + delay;\r\n              noteOffRegistrar[key] = {\r\n                channel: channelId,\r\n                note: note,\r\n                now: player.currentProcessedEventTime,\r\n                ctxTime: player.ctxStartTime + delay,\r\n                end: player.endTime,\r\n                message: 128,\r\n                velocity: event.velocity,\r\n                rawData: event.rawData,\r\n                track: event.track,\r\n              }\r\n              break\r\n            default:\r\n              break\r\n          }\r\n        }\r\n      }\r\n\r\n      const currentTime =  player.getContext().currentTime;\r\n      //console.log(currentTime)\r\n      for (const note in noteOffRegistrar) {\r\n        // if(!noteRegistrar[note]){\r\n        //     console.log(noteOffRegistrar[note])\r\n        //     console.log(noteRegistrar)\r\n        // }\r\n        const noteOffData = noteOffRegistrar[note];\r\n        //console.log(note, noteOffData, player.getDisplayedAudioContextPlaytime() * 1000)\r\n        if(note == \"stopAllNotes\"){\r\n          if(noteOffData.ctxTime <= currentTime){\r\n            for (const noteOn in noteRegistrar) {\r\n              const noteOnData = noteRegistrar[noteOn];\r\n              if(noteOnData.ctxTime < noteOffData.ctxTime){\r\n                const noteOnData = noteRegistrar[noteOn];\r\n                //console.log(\"all off\", noteRegistrar[noteOn], note)\r\n                delete noteRegistrar[noteOn];\r\n              }\r\n            }\r\n            delete noteOffRegistrar[note];\r\n          }\r\n        }\r\n        else \r\n        // if(noteOffData.now <= player.getDisplayedAudioContextPlaytime() * 1000){\r\n        //   for (const noteOn in noteRegistrar) {\r\n        //     const noteOnData = noteRegistrar[noteOn];\r\n        //     if((noteOnData.note == noteOffData.note && noteOnData.channel == noteOffData.channel ) && noteOnData.now < noteOffData.now){\r\n        //       console.log(\"time off\", noteRegistrar[noteOn], note)\r\n        //       delete noteRegistrar[noteOn];\r\n        //     }\r\n        //   }\r\n        //   delete noteOffRegistrar[note];\r\n        // }\r\n        //console.log( \"==============\", currentTime)\r\n        if(noteOffData.ctxTime <= currentTime){\r\n         // console.log( \"==== noteOff checking\", noteOffData, \"---\", currentTime)\r\n          for (const noteOn in noteRegistrar) {\r\n            const noteOnData = noteRegistrar[noteOn];\r\n            //console.log(noteOnData)\r\n            if((noteOnData.note == noteOffData.note && noteOnData.channel == noteOffData.channel ) && noteOnData.ctxTime < noteOffData.ctxTime){\r\n              //console.log(\"timeoff\", noteOnData)\r\n              delete noteRegistrar[noteOn];\r\n            }\r\n          }\r\n          delete noteOffRegistrar[note];\r\n        }\r\n      }\r\n\r\n      if(player.getDisplayedAudioContextPlaytime() < player.lastDisplayedAudioContextPlaytime){\r\n        // noteRegistrar = {}\r\n        // noteOffRegistrar = {}\r\n        // root.stopAllNotes()\r\n        // console.log(player.getDisplayedAudioContextPlaytime(), player.lastDisplayedAudioContextPlaytime)\r\n        \r\n      }\r\n      player.lastDisplayedAudioContextPlaytime = player.getDisplayedAudioContextPlaytime();\r\n\r\n\r\n      for (const api in root.API) {\r\n        if(root.API[api].avaliable && root.API[api].api.onLoopCallBack){\r\n          root.API[api].api.onLoopCallBack(dt);\r\n        }\r\n      }\r\n    }, 5)\r\n  }\r\n\r\n  root.setChannelMute = function (channelId, isMuted, delay) {\r\n    var channel = root.channels[channelId]\r\n    if (delay) {\r\n      return setTimeout(function () {\r\n        channel.mute = isMuted\r\n      }, delay)\r\n    } else {\r\n      channel.mute = isMuted\r\n    }\r\n    \r\n  }\r\n\r\n  root.setUseMetronome = function (value) {\r\n    player.useMetronome = value;\r\n  }\r\n\r\n  root.getActiveNotes = function () {\r\n    const currentTime = player.getContext().currentTime; //player.getDisplayedAudioContextPlaytime() * 1000\r\n    var notes = []\r\n    //console.log(noteRegistrar)\r\n    for(var noteOn in noteRegistrar){\r\n      const noteOnData = noteRegistrar[noteOn];\r\n      if(noteOnData.ctxTime <= currentTime){\r\n        // let alreadyOff = false;\r\n        // for(var noteOff in noteOffRegistrar){\r\n        //   const noteOffData = noteOffRegistrar[noteOff];\r\n        //   if(noteOffData.note == noteOnData.note && noteOffData.channel == noteOnData.channel && noteOffData.ctxTime < currentTime - 0.01){\r\n        //     alreadyOff = true\r\n        //     break;\r\n        //   }\r\n        // }\r\n        // if(!alreadyOff){\r\n          notes.push(noteOnData)\r\n        //}\r\n      }\r\n    }\r\n    //console.log(notes, currentTime)\r\n    return notes;\r\n  }\r\n\r\n  \r\n  var __now\r\n  var getNow = function () {\r\n    if (window.performance && window.performance.now) {\r\n      return window.performance.now()\r\n    } else {\r\n      return Date.now()\r\n    }\r\n  }\r\n\r\n  \r\n  player.clearAnimation = function () {\r\n    if (player.animationFrameId) {\r\n      window.cancelAnimationFrame(player.animationFrameId)\r\n    }\r\n  }\r\n\r\n  player.setAnimation = function (callback) {\r\n    var currentTime = 0\r\n    var tOurTime = 0\r\n    var tTheirTime = 0\r\n    //\r\n    player.clearAnimation()\r\n    // /\r\n    var frame = function () {\r\n      player.animationFrameId = window.requestAnimationFrame(frame)\r\n      // /\r\n      if (player.endTime === 0) {\r\n        return\r\n      }\r\n      if (player.playing) {\r\n        currentTime = (tTheirTime === player.currentTime) ? tOurTime - Date.now() : 0\r\n        if (player.currentTime === 0) {\r\n          currentTime = 0\r\n        } else {\r\n          currentTime = player.currentTime - currentTime\r\n        }\r\n        if (tTheirTime !== player.currentTime) {\r\n          tOurTime = Date.now()\r\n          tTheirTime = player.currentTime\r\n        }\r\n      } else { // paused\r\n        currentTime = player.currentTime\r\n        tOurTime = Date.now();\r\n        tTheirTime = player.currentTime;\r\n      }\r\n      // /\r\n      // if (currentTime == 0 && player.playing) currentTime = ((Date.now() - player.ctxStartTime * 10) - player.playingStartTime) / 100 * MIDI.Player.BPM;\r\n\r\n      var endTime = player.endTime\r\n      // var percent = currentTime / endTime\r\n      var t1 = currentTime / 1000;\r\n      var t2 = endTime / 1000;\r\n      // /\r\n      if (t2 - t1 < -1.0) {\r\n        return\r\n      } else {\r\n        callback({\r\n          now: t1,\r\n          end: t2,\r\n          events: noteRegistrar\r\n        })\r\n      }\r\n      player.lastCallbackTime = currentTime;\r\n\r\n      if (currentTime > endTime) {\r\n        stopAudio();\r\n        if (typeof player.onEnd != 'undefined') player.onEnd();\r\n      }\r\n    }\r\n    // /\r\n    window.requestAnimationFrame(frame)\r\n  }\r\n\r\n  // helpers\r\n\r\n  player.loadMidiFile = async function () { //onsuccess, onprogress, onerror\r\n    try {\r\n      // console.log(MidiFile(player.currentData), new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM))\r\n      console.log(MidiFile(player.currentData));\r\n      player.replayer = new Replayer(MidiFile(player.currentData), player.timeWarp, null, player.BPM, player.TimeSignitures, player.Measures )\r\n      player.data = player.replayer.getData()\r\n      player.endTime = getLength()\r\n      // /\r\n      // root.loadPlugin({\r\n      //   // instruments: player.getFileInstruments(),\r\n      //   onsuccess: onsuccess,\r\n      //   onprogress: onprogress,\r\n      //   onerror: onerror\r\n      // })\r\n    } catch (event) {\r\n      console.error(event)\r\n      onerror && onerror(event)\r\n    }\r\n  }\r\n\r\n  player.loadFile = async function (file) { // onsuccess, onprogress, onerror)\r\n    player.stop()\r\n    if (file.indexOf('base64,') !== -1) {\r\n      var data = window.atob(file.split(',')[1])\r\n      player.currentData = data\r\n      await player.loadMidiFile()\r\n    } else {\r\n      await new Promise((resolve, reject)=>{\r\n        var fetch = new window.XMLHttpRequest()\r\n        fetch.open('GET', file)\r\n        fetch.overrideMimeType('text/plain; charset=x-user-defined')\r\n        fetch.onreadystatechange = async function () {\r\n          if (this.readyState === 4) {\r\n            if (this.status === 200) {\r\n              var t = this.responseText || ''\r\n              var ff = []\r\n              var mx = t.length\r\n              var scc = String.fromCharCode\r\n              for (var z = 0; z < mx; z++) {\r\n                ff[z] = scc(t.charCodeAt(z) & 255)\r\n              }\r\n              // /\r\n              var data = ff.join('')\r\n              player.currentData = data\r\n              await player.loadMidiFile()\r\n              resolve();\r\n            } else {\r\n              reject();\r\n            }\r\n          }\r\n        }\r\n        fetch.send()\r\n      });\r\n      \r\n    }\r\n  }\r\n\r\n  player.getFileInstruments = function () {\r\n    var instruments = {}\r\n    var programs = {}\r\n    for (var n = 0; n < player.data.length; n++) {\r\n      var event = player.data[n][0].event\r\n      if (event.type !== 'channel') {\r\n        continue\r\n      }\r\n      var channel = event.channel\r\n      switch (event.subtype) {\r\n        case 'controller':\r\n          //        console.log(event.channel, root.defineControl[event.controllerType], event.value)\r\n          break\r\n        case 'programChange':\r\n          programs[channel] = event.programNumber\r\n          break\r\n        case 'noteOn':\r\n          var program = programs[channel]\r\n          var gm = root.GM.byId[isFinite(program) ? program : channel]\r\n          instruments[gm.id] = true\r\n          break\r\n      }\r\n    }\r\n    var ret = []\r\n    for (var key in instruments) {\r\n      ret.push(key)\r\n    }\r\n    return ret\r\n  }\r\n\r\n  // Playing the audio\r\n\r\n  //var eventQueue = [] // hold events to be triggered\r\n\r\n  // var scheduleTracking = function (channel, note, currentTime, wait, message, velocity, eventObj) {\r\n  //   var wait = wait;\r\n  //   return setTimeout(function () {\r\n  //     var data = {\r\n  //       channel: channel,\r\n  //       note: note,\r\n  //       now: currentTime,\r\n  //       end: player.endTime,\r\n  //       message: message,\r\n  //       velocity: velocity,\r\n  //       rawData: eventObj.rawData\r\n  //     }\r\n  //     //\r\n  //     if (message === 128) {\r\n  //       delete noteRegistrar[note]\r\n  //     } else {\r\n  //       noteRegistrar[note] = data\r\n  //     }\r\n  //     if (onMidiEvent) {\r\n  //       onMidiEvent(data)\r\n  //     }\r\n  //     player.currentTime = currentTime\r\n  //     // /\r\n  //     eventQueue.shift()\r\n  //     // /\r\n  //     // var allowedTimeStep = 2;\r\n  //     // for (const iterator of eventQueue) {\r\n        \r\n  //     // }\r\n  //     if (eventQueue.length < 10) {\r\n  //       startAudio(player.queuedTime, true)\r\n  //     } else if (player.getAudioContextPlaytime() >= (player.queuedTime / 1000) - player.minLookAheadTime && player.queuedTime < player.endTime) { // grab next sequence\r\n  //       startAudio(player.queuedTime, true)\r\n  //     }\r\n  //   }, wait)\r\n  // }\r\n\r\n\r\n  // var startAudio = function (currentTime, fromCache, onsuccess) {\r\n  //   if (!player.replayer) {\r\n  //     return\r\n  //   }\r\n  //   if (!fromCache) {\r\n  //     if (typeof currentTime === 'undefined') {\r\n  //       currentTime = player.restart\r\n  //     }\r\n  //     // /\r\n  //     player.playing && stopAudio()\r\n  //     player.playing = true\r\n  //     player.data = player.replayer.getData()\r\n  //     player.endTime = getLength()\r\n  //   }\r\n  //   // /\r\n  //   var note\r\n  //   var offset = 0\r\n  //   var messages = 0\r\n  //   var data = player.data\r\n  //   var ctx = player.getContext()\r\n  //   var length = data.length\r\n\r\n  //   //console.log(\"========\", currentTime, \"===========\", length, messages, eventQueue);\r\n  //   //\r\n  //   player.queuedTime = 0.5\r\n  //   // /\r\n  //   // var interval = eventQueue[0] && eventQueue[0].interval || 0\r\n  //   var foffset = currentTime - player.currentTime\r\n  //   // /\r\n  //   // if (root.api !== 'webaudio') { // set currentTime on ctx\r\n  //   //   var now = getNow()\r\n  //   //   __now = __now || now\r\n  //   //   ctx.currentTime = (now - __now) / 1000\r\n  //   // }\r\n  //   // /\r\n   \r\n  //   startTime = currentTime;\r\n  //   // player.playingStartTime = Date.now() - startTime * 10;\r\n  //   // /\r\n  //   //console.log(data);\r\n  //   var allowedTimeStep = 3; //player.eventPosition\r\n  //   for (var n = 0; n < length && allowedTimeStep > 0; n++) {\r\n  //     var obj = data[n];\r\n  //     //console.log(\"-\", obj);\r\n  //     // console.log(currentTime, player.queuedTime, obj[0], obj[0].event);\r\n  //     //console.log(player.queuedTime, obj[1], offset);\r\n  //     // if (player.getAudioContextPlaytime() >= (player.queuedTime / 1000) - player.minLookAheadTime){\r\n  //     //   break;\r\n  //     // }\r\n  //     //player.eventPosition += 1;\r\n      \r\n  //     player.queuedTime += obj[1]\r\n  //     if ((player.queuedTime) <= currentTime) {\r\n  //       offset = player.queuedTime;\r\n  //       //console.log(\"in\", currentTime, player.queuedTime, obj[1], obj[0].event);\r\n  //       if (currentTime > 0.5) {\r\n  //            //console.log(\"in\", currentTime, player.queuedTime, obj[1], obj[0].event);\r\n  //           continue;\r\n  //       }\r\n  //     }\r\n\r\n  //     if(obj[1] > 0){\r\n  //       allowedTimeStep -= 1;\r\n  //     }\r\n  //     //console.log(\"!!\", currentTime, player.queuedTime, offset);\r\n  //     // /\r\n  //     currentTime = player.queuedTime - offset;\r\n  //     // /\r\n  //     var event = obj[0].event;\r\n  //     if (event.type !== 'channel') {\r\n  //       continue;\r\n  //     }\r\n\r\n     \r\n  //     // /\r\n  //     var channelId = event.channel\r\n  //     var channel = root.channels[channelId]\r\n  //     var delay = player.ctxStartTime + ((currentTime + startTime - player.playingStartTime + player.startDelay) / 1000)\r\n\r\n  //     var scheduleWait = delay - ctx.currentTime / 1000;\r\n  //     //console.log(ctx.currentTime, player.ctxStartTime, currentTime, foffset);\r\n  //     //console.log(\"event\", obj, delay, ctx.currentTime, allowedTimeStep);\r\n\r\n      \r\n\r\n  //     var queueTime = player.queuedTime - offset + player.startDelay\r\n  //     switch (event.subtype) {\r\n  //       case 'controller':\r\n  //         root.setController(event, channelId, event.controllerType, event.value, delay)\r\n  //         break\r\n  //       case 'programChange':\r\n  //         if(!player.OverrideProgramChanges){\r\n  //           //console.log(event);\r\n  //            root.programChange(event, channelId, event.programNumber, delay)\r\n  //         }\r\n  //         break\r\n  //       case 'pitchBend':\r\n  //         root.pitchBend(event, channelId, event.value, delay)\r\n  //         break\r\n  //       case 'noteOn':\r\n  //         if (channel.mute) break\r\n  //         note = event.noteNumber + (player.MIDIOffset || 0)\r\n  //          event.rawData[1] = note\r\n  //         //console.log(channelId, note, event.velocity, delay);\r\n  //         eventQueue.push({\r\n  //           event: event,\r\n  //           time: queueTime,\r\n  //           source: root.noteOn(event, channelId, note, event.velocity, delay),\r\n  //           interval: scheduleTracking(event, channelId, note, player.queuedTime + player.startDelay, scheduleWait, 144, event.velocity, event)\r\n  //         })\r\n  //         messages++\r\n  //         break\r\n  //       case 'noteOff':\r\n  //         if (channel.mute) break\r\n  //         note = event.noteNumber + (player.MIDIOffset || 0)\r\n  //          event.rawData[1] = note\r\n  //         //console.log(note, player.MIDIOffset, event.noteNumber);\r\n  //         eventQueue.push({\r\n  //           event: event,\r\n  //           time: queueTime,\r\n  //           source: root.noteOff(event, channelId, note, delay),\r\n  //           interval: scheduleTracking(event, channelId, note, player.queuedTime, scheduleWait, 128, 0, event)\r\n  //         })\r\n  //         break\r\n  //       default:\r\n  //         break\r\n  //     }\r\n  //   }\r\n  //   // /\r\n  //   onsuccess && onsuccess(eventQueue)\r\n  // }\r\n\r\n\r\n\r\n})()\r\n\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/player.js\n **/","export * from './midifile'\r\nexport * from './replayer'\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/index.js\n **/","/**\r\n * class to parse the .mid file format\r\n * (depends on _stream.js)\r\n */\r\n\r\nimport Stream from './_stream'\r\n\r\nexport function MidiFile(data) {\r\n  var lastEventTypeByte\r\n\r\n  function readChunk(stream) {\r\n    var id = stream.read(4)\r\n    var length = stream.readInt32()\r\n    return {\r\n      'id': id,\r\n      'length': length,\r\n      'data': stream.read(length)\r\n    }\r\n  }\r\n\r\n  function readEvent(stream) {\r\n    var event = {};\r\n\r\n    event.deltaTime = stream.readVarInt();\r\n    stream.clearLastReadBytes();\r\n    var eventTypeByte = stream.readInt8();\r\n    if ((eventTypeByte & 0xf0) === 0xf0) {\r\n      /* system / meta event */\r\n\r\n      if (eventTypeByte === 0xff) {\r\n        /* meta event */\r\n        event.type = 'meta';\r\n        var subtypeByte = stream.readInt8();\r\n        var length = stream.readVarInt();\r\n        switch (subtypeByte) {\r\n          case 0x00:\r\n            event.subtype = 'sequenceNumber';\r\n            if (length !== 2) throw new Error('Expected length for sequenceNumber event is 2, got ' + length);\r\n            event.number = stream.readInt16();\r\n            return event;\r\n          case 0x01:\r\n            event.subtype = 'text';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x02:\r\n            event.subtype = 'copyrightNotice';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x03:\r\n            event.subtype = 'trackName';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x04:\r\n            event.subtype = 'instrumentName';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x05:\r\n            event.subtype = 'lyrics';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x06:\r\n            event.subtype = 'marker';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x07:\r\n            event.subtype = 'cuePoint';\r\n            event.text = stream.read(length);\r\n            return event;\r\n          case 0x20:\r\n            event.subtype = 'midiChannelPrefix';\r\n            if (length !== 1) throw new Error('Expected length for midiChannelPrefix event is 1, got ' + length);\r\n            event.channel = stream.readInt8();\r\n            return event;\r\n          case 0x2f:\r\n            event.subtype = 'endOfTrack';\r\n            if (length !== 0) throw new Error('Expected length for endOfTrack event is 0, got ' + length);\r\n            return event;\r\n          case 0x51:\r\n            event.subtype = 'setTempo';\r\n            if (length !== 3) throw new Error('Expected length for setTempo event is 3, got ' + length);\r\n            event.microsecondsPerBeat = (stream.readInt8() << 16) + (stream.readInt8() << 8) + stream.readInt8();\r\n            return event;\r\n          case 0x54:\r\n            event.subtype = 'smpteOffset';\r\n            if (length !== 5) throw new Error('Expected length for smpteOffset event is 5, got ' + length);\r\n            var hourByte = stream.readInt8();\r\n            event.frameRate = {\r\n              0x00: 24, 0x20: 25, 0x40: 29, 0x60: 30\r\n            }[hourByte & 0x60];\r\n            event.hour = hourByte & 0x1f;\r\n            event.min = stream.readInt8();\r\n            event.sec = stream.readInt8();\r\n            event.frame = stream.readInt8();\r\n            event.subframe = stream.readInt8();\r\n            return event;\r\n          case 0x58:\r\n            event.subtype = 'timeSignature';\r\n            if (length !== 4) throw new Error('Expected length for timeSignature event is 4, got ' + length);\r\n            event.numerator = stream.readInt8();\r\n            event.denominator = Math.pow(2, stream.readInt8());\r\n            event.metronome = stream.readInt8();\r\n            event.thirtyseconds = stream.readInt8();\r\n            return event;\r\n          case 0x59:\r\n            event.subtype = 'keySignature';\r\n            if (length !== 2) throw new Error('Expected length for keySignature event is 2, got ' + length);\r\n            event.key = stream.readInt8(true);\r\n            event.scale = stream.readInt8();\r\n            return event;\r\n          case 0x7f:\r\n            event.subtype = 'sequencerSpecific';\r\n            event.data = stream.read(length);\r\n            return event;\r\n          default:\r\n            // console.log(\"Unrecognised meta event subtype: \" + subtypeByte)\r\n            event.subtype = 'unknown';\r\n            event.data = stream.read(length);\r\n            return event;\r\n        }\r\n        // event.data = storeAndReturn(rawData, stream.read(length)\r\n        // return event\r\n      } else if (eventTypeByte === 0xf0) {\r\n        event.type = 'sysEx';\r\n        var _length = stream.readVarInt();\r\n        event.data = stream.read(_length);\r\n        return event;\r\n      } else if (eventTypeByte === 0xf7) {\r\n        event.type = 'dividedSysEx';\r\n        var _length2 = stream.readVarInt();\r\n        event.data = stream.read(_length2);\r\n        return event;\r\n      } else {\r\n        throw new Error('Unrecognised MIDI event type byte: ' + eventTypeByte);\r\n      }\r\n    } else {\r\n      /* channel event */\r\n      var param1;\r\n      if ((eventTypeByte & 0x80) === 0) {\r\n        /* running status - reuse lastEventTypeByte as the event type.\r\n          eventTypeByte is actually the first parameter\r\n        */\r\n        param1 = eventTypeByte;\r\n        eventTypeByte = lastEventTypeByte;\r\n      } else {\r\n        param1 = stream.readInt8();\r\n        lastEventTypeByte = eventTypeByte;\r\n      }\r\n      var eventType = eventTypeByte >> 4;\r\n      event.channel = eventTypeByte & 0x0f;\r\n      event.type = 'channel';\r\n      switch (eventType) {\r\n        case 0x08:\r\n          event.subtype = 'noteOff';\r\n          event.noteNumber = param1;\r\n          event.velocity = stream.readInt8();\r\n          //return event;\r\n          break;\r\n        case 0x09:\r\n          event.noteNumber = param1;\r\n          event.velocity = stream.readInt8();\r\n          if (event.velocity === 0) {\r\n            event.subtype = 'noteOff';\r\n          } else {\r\n            event.subtype = 'noteOn';\r\n          }\r\n          //return event;\r\n          break;\r\n        case 0x0a:\r\n          event.subtype = 'noteAftertouch';\r\n          event.noteNumber = param1;\r\n          event.amount = stream.readInt8();\r\n          //return event;\r\n          break;\r\n        case 0x0b:\r\n          event.subtype = 'controller';\r\n          event.controllerType = param1;\r\n          event.value = stream.readInt8();\r\n          //return event;\r\n          break;\r\n        case 0x0c:\r\n          event.subtype = 'programChange';\r\n          event.programNumber = param1;\r\n          //return event;\r\n          break;\r\n        case 0x0d:\r\n          event.subtype = 'channelAftertouch';\r\n          event.amount = param1;\r\n          //return event;\r\n          break;\r\n        case 0x0e:\r\n          event.subtype = 'pitchBend';\r\n          event.value = param1 + (stream.readInt8() << 7);\r\n          //return event;\r\n          break;\r\n        default:\r\n          throw new Error('Unrecognised MIDI event type: ' + eventType);\r\n        /*\r\n        console.log(\"Unrecognised MIDI event type: \" + eventType)\r\n        stream.readInt8()\r\n        event.subtype = 'unknown'\r\n        return event\r\n        */\r\n      }\r\n      event.rawData = stream.getLastReadBytes();\r\n      //console.log(event)\r\n      return event;\r\n    }\r\n  }\r\n\r\n  const stream = Stream(data)\r\n  var headerChunk = readChunk(stream)\r\n  if (headerChunk.id !== 'MThd' || headerChunk.length !== 6) {\r\n    throw new Error('Bad .mid file - header not found')\r\n  }\r\n  var headerStream = Stream(headerChunk.data)\r\n  var formatType = headerStream.readInt16()\r\n  var trackCount = headerStream.readInt16()\r\n  var timeDivision = headerStream.readInt16()\r\n  var ticksPerBeat\r\n\r\n  if (timeDivision & 0x8000) {\r\n    throw new Error('Expressing time division in SMTPE frames is not supported yet')\r\n  } else {\r\n    ticksPerBeat = timeDivision\r\n  }\r\n\r\n  var header = {\r\n    'formatType': formatType,\r\n    'trackCount': trackCount,\r\n    'ticksPerBeat': ticksPerBeat\r\n  }\r\n  var tracks = []\r\n  for (var i = 0; i < header.trackCount; i++) {\r\n    tracks[i] = []\r\n    var trackChunk = readChunk(stream)\r\n    if (trackChunk.id !== 'MTrk') {\r\n      throw new Error('Unexpected chunk - expected MTrk, got ' + trackChunk.id)\r\n    }\r\n    var trackStream = Stream(trackChunk.data)\r\n    while (!trackStream.eof()) {\r\n      var event = readEvent(trackStream)\r\n      event.track = i;\r\n      tracks[i].push(event)\r\n      //console.log(event)\r\n    }\r\n  }\r\n\r\n  return {\r\n    'header': header,\r\n    'tracks': tracks\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/midifile.js\n **/","/* Wrapper for accessing strings through sequential reads */\r\nexport default function (str) {\r\n  var position = 0\r\n  var lastReadBytes = []\r\n\r\n  function getLastReadBytes() {\r\n    return lastReadBytes.slice();\r\n  }\r\n\r\n  function clearLastReadBytes() {\r\n    lastReadBytes.length = 0;\r\n  }\r\n\r\n  function moveReadPosition(length) {\r\n    for (var index = 0; index < length; index++) {\r\n      lastReadBytes.push(str.charCodeAt(position + index));\r\n    }\r\n    position += length;\r\n  }\r\n\r\n  function read(length) {\r\n    var result = str.substr(position, length)\r\n    moveReadPosition(length);\r\n    return result\r\n  }\r\n\r\n  /* read a big-endian 32-bit integer */\r\n  function readInt32() {\r\n    var result = (\r\n      (str.charCodeAt(position) << 24) +\r\n      (str.charCodeAt(position + 1) << 16) +\r\n      (str.charCodeAt(position + 2) << 8) +\r\n      str.charCodeAt(position + 3))\r\n\r\n    moveReadPosition(4)\r\n    return result\r\n  }\r\n\r\n  /* read a big-endian 16-bit integer */\r\n  function readInt16() {\r\n    var result = (\r\n      (str.charCodeAt(position) << 8) +\r\n      str.charCodeAt(position + 1))\r\n    moveReadPosition(2)\r\n    return result\r\n  }\r\n\r\n  /* read an 8-bit integer */\r\n  function readInt8(signed) {\r\n    var result = str.charCodeAt(position)\r\n    if (signed && result > 127) result -= 256\r\n    moveReadPosition(1)\r\n    return result\r\n  }\r\n\r\n  function eof() {\r\n    return position >= str.length\r\n  }\r\n\r\n  /* read a MIDI-style variable-length integer\r\n    (big-endian value in groups of 7 bits,\r\n    with top bit set to signify that another byte follows)\r\n  */\r\n  function readVarInt() {\r\n    var result = 0\r\n    while (true) {\r\n      var b = readInt8()\r\n      if (b & 0x80) {\r\n        result += (b & 0x7f)\r\n        result <<= 7\r\n      } else {\r\n        /* b is the last byte */\r\n        return result + b\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    'eof': eof,\r\n    'read': read,\r\n    'readInt32': readInt32,\r\n    'readInt16': readInt16,\r\n    'readInt8': readInt8,\r\n    'readVarInt': readVarInt,\r\n    'getLastReadBytes': getLastReadBytes,\r\n    'clearLastReadBytes': clearLastReadBytes,\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/_stream.js\n **/","const clone = function (o) {\r\n  if (typeof o !== 'object') return (o)\r\n  if (o === null) return (o)\r\n  var ret = (typeof o.length === 'number') ? [] : {}\r\n  for (var key in o) ret[key] = clone(o[key])\r\n  return ret\r\n}\r\n\r\nexport function Replayer (midiFile, timeWarp, eventProcessor, bpm, inputTimeSignitures, inputMeasures) {\r\n  var trackStates = []\r\n  var beatsPerMinute = bpm || 120\r\n  var bpmOverride = !!bpm\r\n  var ticksPerBeat = midiFile.header.ticksPerBeat\r\n\r\n  var timeSignitures = inputTimeSignitures\r\n  if(!timeSignitures || timeSignitures.length == 0)\r\n    timeSignitures = [{time:0, numerator:4, denominator: 4}];\r\n\r\n  var measures = inputMeasures\r\n  if(!measures || measures.length == 0)\r\n    measures = [0.0];\r\n\r\n  for (let i = 0; i < midiFile.tracks.length; i++) {\r\n    trackStates[i] = {\r\n      'nextEventIndex': 0,\r\n      'ticksToNextEvent': (midiFile.tracks[i].length ? midiFile.tracks[i][0].deltaTime : null)\r\n    }\r\n  }\r\n\r\n  function getNextEvent () {\r\n    var ticksToNextEvent = null\r\n    var nextEventTrack = null\r\n    var nextEventIndex = null\r\n\r\n    for (let i = 0; i < trackStates.length; i++) {\r\n      if (\r\n        trackStates[i].ticksToNextEvent != null &&\r\n        (ticksToNextEvent == null || trackStates[i].ticksToNextEvent < ticksToNextEvent)\r\n      ) {\r\n        ticksToNextEvent = trackStates[i].ticksToNextEvent\r\n        nextEventTrack = i\r\n        nextEventIndex = trackStates[i].nextEventIndex\r\n      }\r\n    }\r\n    if (nextEventTrack != null) {\r\n      /* consume event from that track */\r\n      var nextEvent = midiFile.tracks[nextEventTrack][nextEventIndex]\r\n      if (midiFile.tracks[nextEventTrack][nextEventIndex + 1]) {\r\n        trackStates[nextEventTrack].ticksToNextEvent += midiFile.tracks[nextEventTrack][nextEventIndex + 1].deltaTime\r\n      } else {\r\n        trackStates[nextEventTrack].ticksToNextEvent = null\r\n      }\r\n      trackStates[nextEventTrack].nextEventIndex += 1\r\n      /* advance timings on all tracks by ticksToNextEvent */\r\n      for (let i = 0; i < trackStates.length; i++) {\r\n        if (trackStates[i].ticksToNextEvent != null) {\r\n          trackStates[i].ticksToNextEvent -= ticksToNextEvent\r\n        }\r\n      }\r\n      return {\r\n        'ticksToEvent': ticksToNextEvent,\r\n        'event': nextEvent,\r\n        'track': nextEventTrack,\r\n        'type': 'midiEvent',\r\n      }\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n\r\nfunction addMetronomeEvents2(currentTick, ticksToProcess, temporal){\r\n  var i = 0;\r\n  var endingTick = currentTick + ticksToProcess;\r\n  var totalWait = 0;\r\n  //console.log(\"ticksToProcess\", currentTick, ticksToProcess, endingTick)\r\n  for(let i = 0; i < measures.length; i++){\r\n    let measureTick =  measures[i] * 4 * ticksPerBeat;\r\n    let measureEndTick = i < measures.length -1 ? measures[i + 1] * 4 * ticksPerBeat : endingTick;\r\n    let endTick = Math.min(measureEndTick, endingTick)\r\n    //.log(\"cheecking\", currentTick, i, measures[i]  * 4 , ticksPerBeat, measureTick, endTick)\r\n    var sign = getTimeSignitureForMeasure(timeSignitures, measures[i] * 4)\r\n    var beatTime = ticksPerBeat * 4 / sign.denominator;\r\n    if(currentTick + beatTime >= measureTick && currentTick < endTick){ // \r\n\r\n      let wait;\r\n\r\n      if((currentTick - measureTick) % beatTime != 0){\r\n        wait =  beatTime - ((currentTick - measureTick) % beatTime)\r\n      }\r\n      else{\r\n        wait = 0;\r\n      }\r\n      //console.log(currentTick - measureTick, beatTime, (currentTick - measureTick) % beatTime)\r\n      //console.log(measures[i] * 4, sign, wait)\r\n      \r\n      if(currentTick + wait < endTick){\r\n        //console.log(currentTick, wait, endTick)\r\n        addSingleMetronomeEvent(currentTick, wait, sign)\r\n        totalWait += wait;\r\n        currentTick += wait;\r\n        //current tick is now aligned with beat\r\n        while(currentTick + beatTime < endTick){\r\n          let wait = beatTime;\r\n          //console.log(currentTick, wait, endTick)\r\n          addSingleMetronomeEvent(currentTick, wait, sign)\r\n          totalWait += wait;\r\n          currentTick += wait;\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  return totalWait\r\n}\r\n  \r\nfunction addMetronomeEvents(currentTick, ticksToProcess, temporal){\r\n    var i = 0;\r\n    var endingTick = currentTick + ticksToProcess;\r\n    var totalWait = 0;\r\n    //console.log(\"ticksToProcess\", ticksToProcess, endingTick, timeSignitures)\r\n    for(var sign of timeSignitures){\r\n      //console.log(sign, currentTick + ticksToProcess)\r\n      i++;\r\n      var signTime = sign.time;\r\n      var nextSignTime = timeSignitures.length < i ? timeSignitures[i].time * ticksPerBeat: currentTick + ticksToProcess\r\n      if(signTime >= currentTick + ticksToProcess){\r\n        break;\r\n      }\r\n      var beatTime = ticksPerBeat * 4 / sign.denominator;\r\n\r\n\r\n      //console.log(currentTick, currentTick + wait , endingTick)\r\n\r\n      let wait;\r\n      if((currentTick - signTime) % beatTime != 0){\r\n        wait =  beatTime - ((currentTick - signTime) % beatTime)\r\n      }\r\n      else{\r\n       wait = 0;\r\n      }\r\n      \r\n      if(currentTick + wait < endingTick){\r\n        \r\n        addSingleMetronomeEvent(currentTick, wait, sign)\r\n        totalWait += wait;\r\n        currentTick += wait;\r\n\r\n        //current tick is now aligned with beat\r\n        while(currentTick + beatTime < nextSignTime && currentTick + beatTime < endingTick){\r\n          let wait = beatTime;\r\n          addSingleMetronomeEvent(currentTick, wait, sign)\r\n          totalWait += wait;\r\n          currentTick += wait;\r\n        }\r\n      }\r\n    }\r\n\r\n    return totalWait;\r\n  }\r\n\r\n  function addSingleMetronomeEvent(currentTick, wait, sign) {\r\n      var beatsToGenerate = wait / ticksPerBeat\r\n      var secondsToGenerate = beatsToGenerate / (beatsPerMinute / 60)\r\n      var time = (secondsToGenerate * 1000 * timeWarp) || 0\r\n\r\n      var metronomeEventsType = 'light'\r\n      // if ((((wait + currentTick) - (sign.time * ticksPerBeat)) / ticksPerBeat) % sign.numerator == 0) {\r\n      //   metronomeEventsType = 'heavy'\r\n      // }\r\n      //console.log(measures)\r\n      for (const measureTime of measures) {\r\n          //console.log(measureTime * ticksPerBeat * 4, wait + currentTick)\r\n         if(measureTime * ticksPerBeat * 4 == wait + currentTick){\r\n           metronomeEventsType = 'heavy'\r\n           break;\r\n         }\r\n      }\r\n     \r\n\r\n      //console.log(currentTick, \"addSingleMetronomeEvent\", wait, metronomeEventsType)\r\n\r\n      temporal.push(\r\n        [\r\n          {\r\n            'ticksToEvent': wait,\r\n            'event': {},\r\n            'track': 16,\r\n            'type': 'metronomeEvent',\r\n            'metronomeEventsType': metronomeEventsType\r\n          },\r\n          time\r\n        ]\r\n      )\r\n    }\r\n  //\r\n  var totalTick = 0;\r\n  var midiEvent\r\n  var temporal = []\r\n  ~(function processEvents () {\r\n    function processNext () {\r\n      if (!bpmOverride && midiEvent.event.type === 'meta' && midiEvent.event.subtype === 'setTempo') {\r\n        // tempo change events can occur anywhere in the middle and affect events that follow\r\n        beatsPerMinute = 60000000 / midiEvent.event.microsecondsPerBeat\r\n      }\r\n      // /\r\n      var beatsToGenerate = 0\r\n      var secondsToGenerate = 0\r\n      var  ticksInMetronomeEvents = 0\r\n      if (midiEvent.ticksToEvent > 0) {\r\n        var ticksInMetronomeEvents = addMetronomeEvents2(totalTick, midiEvent.ticksToEvent, temporal);\r\n        totalTick += midiEvent.ticksToEvent;\r\n\r\n        //console.log(midiEvent.ticksToEvent, ticksInMetronomeEvents)\r\n        midiEvent.ticksToEvent = midiEvent.ticksToEvent - ticksInMetronomeEvents;\r\n\r\n        //console.log(midiEvent.ticksToEvent)\r\n\r\n        beatsToGenerate = (midiEvent.ticksToEvent) / ticksPerBeat\r\n        secondsToGenerate = beatsToGenerate / (beatsPerMinute / 60)\r\n      }\r\n      // /\r\n      var time = (secondsToGenerate * 1000 * timeWarp) || 0\r\n\r\n      temporal.push([midiEvent, time])\r\n      midiEvent = getNextEvent()\r\n    }\r\n    // /\r\n    midiEvent = getNextEvent()\r\n    if (midiEvent) {\r\n      while (midiEvent) processNext(true)\r\n    }\r\n\r\n    //console.log(temporal);\r\n  })()\r\n\r\n\r\n  return {\r\n    getData: function () {\r\n      return clone(temporal)\r\n    }\r\n  }\r\n}\r\n\r\nfunction getTimeSignitureForMeasure(timeSignitures, measureTime) {\r\n  var sign = timeSignitures[0]\r\n  for (const s of timeSignitures) {\r\n    if (measureTime >= s.time) {\r\n      sign = s\r\n    }\r\n    else {\r\n      break\r\n    }\r\n  }\r\n  return sign;\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/jasmid/replayer.js\n **/","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nlet preciseIntervals = [], i = 0;\r\nfunction setPreciseInterval(callback, ms, ...args) {\r\n    let previous = Date.now(), id = i++;\r\n    (function exec() {\r\n        preciseIntervals[id] = setTimeout(() => {\r\n            previous += ms;\r\n            callback(...args);\r\n            exec();\r\n        }, ms - (Date.now() - previous));\r\n    })();\r\n    return id;\r\n}\r\nexports.setPreciseInterval = setPreciseInterval;\r\nfunction clearPreciseInterval(preciseIntervalId) {\r\n    clearTimeout(preciseIntervals[preciseIntervalId]);\r\n}\r\nexports.clearPreciseInterval = clearPreciseInterval;\r\n//# sourceMappingURL=index.js.map\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/precise-interval/lib/index.js\n ** module id = 14\n ** module chunks = 0\n **/","import './audiotag'\r\nimport './webaudio'\r\nimport './webmidi'\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/index.js\n **/","/*\r\n  ----------------------------------------------------------------------\r\n  AudioTag <audio> - OGG or MPEG Soundbank\r\n  ----------------------------------------------------------------------\r\n  http://dev.w3.org/html5/spec/Overview.html#the-audio-element\r\n  ----------------------------------------------------------------------\r\n*/\r\nimport root from '../root'\r\n\r\nwindow.Audio && (function () {\r\n  var midi = root.AudioTag = { api: 'audiotag' }\r\n  var noteToKey = {}\r\n  var volume = 127 // floating point\r\n  var bufferNid = -1 // current channel\r\n  var audioBuffers = [] // the audio channels\r\n  var notesOn = [] // instrumentId + noteId that is currently playing in each 'channel', for routing noteOff/chordOff calls\r\n  var notes = {} // the piano keys\r\n  for (let nid = 0; nid < 12; nid++) {\r\n    audioBuffers[nid] = new window.Audio()\r\n  }\r\n\r\n  var playChannel = function (channel, note) {\r\n    if (!root.channels[channel]) return\r\n    var instrument = root.channels[channel].instrument\r\n    var instrumentId = root.GM.byId[instrument].id\r\n    note = notes[note]\r\n    if (note) {\r\n      var instrumentNoteId = instrumentId + '' + note.id\r\n      var nid = (bufferNid + 1) % audioBuffers.length\r\n      var audio = audioBuffers[nid]\r\n      notesOn[ nid ] = instrumentNoteId\r\n      if (!root.Soundfont[instrumentId]) {\r\n        if (root.DEBUG) {\r\n          console.log('404', instrumentId)\r\n        }\r\n        return\r\n      }\r\n      audio.src = root.Soundfont[instrumentId][note.id]\r\n      audio.volume = volume / 127\r\n      audio.play()\r\n      bufferNid = nid\r\n    }\r\n  }\r\n\r\n  var stopChannel = function (channel, note) {\r\n    if (!root.channels[channel]) return\r\n    var instrument = root.channels[channel].instrument\r\n    var instrumentId = root.GM.byId[instrument].id\r\n    note = notes[note]\r\n    if (note) {\r\n      var instrumentNoteId = instrumentId + '' + note.id\r\n      for (var i = 0, len = audioBuffers.length; i < len; i++) {\r\n        var nid = (i + bufferNid + 1) % len\r\n        var cId = notesOn[nid]\r\n        if (cId && cId === instrumentNoteId) {\r\n          audioBuffers[nid].pause()\r\n          notesOn[nid] = null\r\n          return\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  midi.audioBuffers = audioBuffers\r\n  midi.send = function (data, delay) {}\r\n  midi.setController = function (event, channel, type, value, delay) {}\r\n  midi.setVolume = function (channel, n) {\r\n    volume = n // - should be channel specific volume\r\n  }\r\n\r\n  midi.programChange = function (event, channel, program) {\r\n    root.channels[channel].instrument = program\r\n  }\r\n\r\n  midi.pitchBend = function (event, channel, program, delay) {}\r\n\r\n  midi.noteOn = function (event, channel, note, velocity, delay) {\r\n    var id = noteToKey[note]\r\n    if (!notes[id]) return\r\n    if (delay) {\r\n      return setTimeout(function () {\r\n        playChannel(channel, id)\r\n      }, delay * 1000)\r\n    } else {\r\n      playChannel(channel, id)\r\n    }\r\n  }\r\n\r\n  midi.noteOff = function (event, channel, note, delay) {\r\n    //      var id = noteToKey[note]\r\n    //      if (!notes[id]) return\r\n    //      if (delay) {\r\n    //        return setTimeout(function() {\r\n    //          stopChannel(channel, id)\r\n    //        }, delay * 1000)\r\n    //      } else {\r\n    //        stopChannel(channel, id)\r\n    //      }\r\n  }\r\n\r\n  midi.chordOn = function (channel, chord, velocity, delay) {\r\n    for (var idx = 0; idx < chord.length; idx++) {\r\n      var n = chord[idx]\r\n      var id = noteToKey[n]\r\n      if (!notes[id]) continue\r\n      if (delay) {\r\n        return setTimeout(function () {\r\n          playChannel(channel, id)\r\n        }, delay * 1000)\r\n      } else {\r\n        playChannel(channel, id)\r\n      }\r\n    }\r\n  }\r\n\r\n  midi.chordOff = function (event, channel, chord, delay) {\r\n    for (var idx = 0; idx < chord.length; idx++) {\r\n      var n = chord[idx]\r\n      var id = noteToKey[n]\r\n      if (!notes[id]) continue\r\n      if (delay) {\r\n        return setTimeout(function () {\r\n          stopChannel(channel, id)\r\n        }, delay * 1000)\r\n      } else {\r\n        stopChannel(channel, id)\r\n      }\r\n    }\r\n  }\r\n\r\n  midi.stopAllNotes = function (delay, lookAhead) {\r\n    for (var nid = 0, length = audioBuffers.length; nid < length; nid++) {\r\n      audioBuffers[nid].pause()\r\n    }\r\n  }\r\n\r\n  midi.connect = async function (opts) {\r\n    root.setDefaultPlugin(midi)\r\n    // /\r\n    for (var key in root.keyToNote) {\r\n      noteToKey[root.keyToNote[key]] = key\r\n      notes[key] = {id: key}\r\n    }\r\n  }\r\n})()\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/audiotag.js\n **/","/*\r\n  ----------------------------------------------------------\r\n  Web Audio API - OGG or MPEG Soundbank\r\n  ----------------------------------------------------------\r\n  http://webaudio.github.io/web-audio-api/\r\n  ----------------------------------------------------------\r\n*/\r\nimport root from '../root'\r\n\r\n// REF: http://stackoverflow.com/questions/21797299/convert-base64-string-to-arraybuffer\r\nfunction base64ToArrayBuffer (base64) {\r\n  var binaryString = window.atob(base64)\r\n  var len = binaryString.length\r\n  var bytes = new Uint8Array(len)\r\n  for (var i = 0; i < len; i++) {\r\n    bytes[i] = binaryString.charCodeAt(i)\r\n  }\r\n  return bytes.buffer\r\n}\r\n\r\nwindow.AudioContext && (function () {\r\n  // var audioContext = null // new AudioContext()\r\n  var useStreamingBuffer = false // !!audioContext.createMediaElementSource\r\n  var midi = root.WebAudio = { api: 'webaudio' }\r\n  var ctx // audio context\r\n  var sources = {}\r\n  var effects = {}\r\n  var masterVolume = 127\r\n  var audioBuffers = {}\r\n  // /\r\n  midi.audioBuffers = audioBuffers\r\n  midi.send = function (data, delay) {}\r\n  midi.setController = function (event, channelId, type, value, delay) {}\r\n\r\n  midi.setVolume = function (channelId, volume, delay) {\r\n    if (delay) {\r\n      setTimeout(function () {\r\n        masterVolume = volume\r\n      }, delay * 1000)\r\n    } else {\r\n      masterVolume = volume\r\n    }\r\n  }\r\n\r\n  midi.programChange = function (event, channelId, program, delay) {\r\n    //      if (delay) {\r\n    //        return setTimeout(function() {\r\n    //          var channel = root.channels[channelId]\r\n    //          channel.instrument = program\r\n    //        }, delay)\r\n    //      } else {\r\n    var channel = root.channels[channelId]\r\n    channel.instrument = program\r\n  //      }\r\n  }\r\n\r\n  midi.pitchBend = function (event, channelId, program, delay) {\r\n    //      if (delay) {\r\n    //        setTimeout(function() {\r\n    //          var channel = root.channels[channelId]\r\n    //          channel.pitchBend = program\r\n    //        }, delay)\r\n    //      } else {\r\n    var channel = root.channels[channelId]\r\n    channel.pitchBend = program\r\n  //      }\r\n  }\r\n\r\n  midi.noteOn = function (event, channelId, noteId, velocity, delay) {\r\n    delay = delay || 0\r\n\r\n  \r\n\r\n    // / check whether the note exists\r\n    var channel = root.channels[channelId]\r\n    var instrument = channel.instrument\r\n    var bufferId = instrument + '' + noteId\r\n    var buffer = audioBuffers[bufferId]\r\n   \r\n    if (!buffer) {\r\n      return\r\n    }\r\n\r\n    // / convert relative delay to absolute delay\r\n    // if (delay < ctx.currentTime) {\r\n    //   delay += ctx.currentTime\r\n    // }\r\n\r\n    delay += midi.ctxStartTime\r\n\r\n    // / create audio buffer\r\n    var source\r\n    if (useStreamingBuffer) {\r\n      source = ctx.createMediaElementSource(buffer)\r\n    } else { // XMLHTTP buffer\r\n      source = ctx.createBufferSource()\r\n      source.buffer = buffer\r\n    }\r\n\r\n    //console.log(\"noteOn\", source);\r\n    // / add effects to buffer\r\n    if (effects) {\r\n      var chain = source\r\n      for (var key in effects) {\r\n        chain.connect(effects[key].input)\r\n        chain = effects[key]\r\n      }\r\n    }\r\n\r\n    // / add gain + pitchShift\r\n    var gain = (velocity / 127) * (masterVolume / 127) * 2 - 1\r\n    source.connect(ctx.destination)\r\n    source.playbackRate.value = 1 // pitch shift\r\n    source.gainNode = ctx.createGain() // gain\r\n    source.gainNode.connect(ctx.destination)\r\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain))\r\n    source.connect(source.gainNode)\r\n    // /\r\n    if (useStreamingBuffer) {\r\n      if (delay) {\r\n        return setTimeout(function () {\r\n          buffer.currentTime = 0\r\n          buffer.play()\r\n        }, delay * 1000)\r\n      } else {\r\n        buffer.currentTime = 0\r\n        buffer.play()\r\n      }\r\n    } else {\r\n      //console.log(delay, ctx.currentTime);\r\n      source.start(delay || 0)\r\n    }\r\n    // /\r\n    if( sources[channelId + '' + noteId] == null){\r\n      sources[channelId + '' + noteId] = [];\r\n    }\r\n    sources[channelId + '' + noteId].push(source)\r\n    // /\r\n    return source\r\n  }\r\n\r\n  midi.noteOff = function (event, channelId, noteId, delay) {\r\n    delay = delay || 0\r\n    \r\n    // / check whether the note exists\r\n    var channel = root.channels[channelId]\r\n    var instrument = channel.instrument\r\n    var bufferId = instrument + '' + noteId\r\n    var buffer = audioBuffers[bufferId]\r\n    if (buffer) {\r\n\r\n      delay += midi.ctxStartTime \r\n      // if (delay < ctx.currentTime) {\r\n      //   delay += ctx.currentTime\r\n      // }\r\n      //console.log(sources[channelId + '' + noteId])\r\n      if (sources[channelId + '' + noteId]) {\r\n        for (const source of sources[channelId + '' + noteId]) {\r\n          if (source) {\r\n            //console.log(\"noteOff\", source);\r\n            if (source.gainNode) {\r\n              // @Miranet: 'the values of 0.2 and 0.3 could of course be used as\r\n              // a 'release' parameter for ADSR like time settings.'\r\n              // add { 'metadata': { release: 0.3 } } to soundfont files\r\n              var gain = source.gainNode.gain\r\n              gain.linearRampToValueAtTime(gain.value, delay)\r\n              gain.linearRampToValueAtTime(-1.0, delay + 0.3)\r\n            }\r\n            // /\r\n            if (useStreamingBuffer) {\r\n              if (delay) {\r\n                setTimeout(function () {\r\n                  buffer.pause()\r\n                }, delay * 1000)\r\n              } else {\r\n                buffer.pause()\r\n              }\r\n            } else {\r\n              if (source.noteOff) {\r\n                source.noteOff(delay + 0.5)\r\n              } else {\r\n                source.stop(delay + 0.5)\r\n              }\r\n            }\r\n\r\n            //console.log(source);\r\n            // /\r\n            //delete sources[channelId + '' + noteId]\r\n            // /\r\n            //return source\r\n          }\r\n        }\r\n      }\r\n      \r\n    }\r\n  }\r\n\r\n  midi.chordOn = function (channel, chord, velocity, delay) {\r\n    \r\n    var res = {}\r\n    for (var n = 0, note, len = chord.length; n < len; n++) {\r\n      res[note = chord[n]] = midi.noteOn(channel, note, velocity, delay)\r\n    }\r\n    return res\r\n  }\r\n\r\n  midi.chordOff = function (channel, chord, delay) {\r\n    var res = {}\r\n    for (var n = 0, note, len = chord.length; n < len; n++) {\r\n      res[note = chord[n]] = midi.noteOff(channel, note, delay)\r\n    }\r\n    return res\r\n  }\r\n\r\n  midi.stopAllNotes = function (delay, lookAhead, stopImmediatelyIfPossible = false) {\r\n    // console.log(\"stopAllNotes\", delay);\r\n    delay += midi.ctxStartTime;\r\n    if (stopImmediatelyIfPossible){\r\n      delay = 0;\r\n    }\r\n\r\n    console.log(stopImmediatelyIfPossible, delay)\r\n    for (var sid in sources) {\r\n      //var delay = 0\r\n      // if (delay < ctx.currentTime) {\r\n      //   delay += ctx.currentTime\r\n      // }\r\n      if(sources[sid]){\r\n        for (const source of sources[sid]) {\r\n          //console.log(source, source.gainNode.gain);\r\n          //try {\r\n          //source.gainNode.gain.linearRampToValueAtTime(source.gainNode.gain.value, delay)\r\n          source.gainNode.gain.linearRampToValueAtTime(0, delay+0.1)\r\n          //} catch(a){\r\n\r\n          //}\r\n          \r\n          if (source.noteOff) { // old api\r\n            source.noteOff(delay+0.1)\r\n          } else { // new api\r\n            source.stop(delay+0.1)\r\n          }\r\n        }\r\n        delete sources[sid]\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n  midi.setEffects = function (list) {\r\n    if (ctx.tunajs) {\r\n      for (var n = 0; n < list.length; n++) {\r\n        var data = list[n]\r\n        var effect = new ctx.tunajs[data.type](data)\r\n        effect.connect(ctx.destination)\r\n        effects[data.type] = effect\r\n      }\r\n    } else {\r\n      return console.log('Effects module not installed.')\r\n    }\r\n  }\r\n\r\n  midi.connect = async function (opts) {\r\n    root.setDefaultPlugin(midi)\r\n    await new Promise((resolve, reject)=>{\r\n       midi.setContext(ctx || createAudioContext(), resolve);\r\n    })\r\n  }\r\n\r\n  midi.getContext = function () {\r\n    return ctx\r\n  }\r\n\r\n  midi.setContext = function (newCtx, onload, onprogress, onerror) {\r\n    ctx = newCtx\r\n\r\n    // / tuna.js effects module - https://github.com/Dinahmoe/tuna\r\n    if (typeof window.Tuna !== 'undefined' && !ctx.tunajs) {\r\n      ctx.tunajs = new window.Tuna(ctx)\r\n    }\r\n\r\n    // / loading audio files\r\n    var urls = []\r\n    var notes = root.keyToNote\r\n    for (let key in notes) urls.push(key)\r\n    // /\r\n    var waitForEnd = function (instrument) {\r\n      for (let key in bufferPending) { // has pending items\r\n        if (bufferPending[key]) return\r\n      }\r\n      // /\r\n      if (onload) { // run onload once\r\n        onload()\r\n        onload = null\r\n      }\r\n    }\r\n    // /\r\n    var requestAudio = function (soundfont, instrumentId, index, key) {\r\n      var url = soundfont[key]\r\n      if (url) {\r\n        bufferPending[instrumentId]++\r\n        loadAudio(url, function (buffer) {\r\n          buffer.id = key\r\n          var noteId = root.keyToNote[key]\r\n          audioBuffers[instrumentId + '' + noteId] = buffer\r\n          // /\r\n          if (--bufferPending[instrumentId] === 0) {\r\n            // var percent = index / 87\r\n            //              console.log(midi.GM.byId[instrumentId], 'processing: ', percent)\r\n            soundfont.isLoaded = true\r\n            waitForEnd(instrument)\r\n          }\r\n        }, function (err) {\r\n          console.error(err)\r\n        })\r\n      }\r\n    }\r\n    // /\r\n    var bufferPending = {}\r\n    for (var instrument in root.Soundfont) {\r\n      var soundfont = root.Soundfont[instrument]\r\n      if (soundfont.isLoaded) {\r\n        continue\r\n      }\r\n      // /\r\n      var synth = root.GM.byName[instrument]\r\n      var instrumentId = synth.number\r\n      // /\r\n      bufferPending[instrumentId] = 0\r\n      // /\r\n      for (let index = 0; index < urls.length; index++) {\r\n        let key = urls[index]\r\n        requestAudio(soundfont, instrumentId, index, key)\r\n      }\r\n    }\r\n    // /\r\n    setTimeout(waitForEnd, 1)\r\n  }\r\n\r\n  /* Load audio file: streaming | base64 | arraybuffer\r\n  ---------------------------------------------------------------------- */\r\n  function loadAudio (url, onload, onerror) {\r\n    if (useStreamingBuffer) {\r\n      var audio = new window.Audio()\r\n      audio.src = url\r\n      audio.controls = false\r\n      audio.autoplay = false\r\n      audio.preload = false\r\n      audio.addEventListener('canplay', function () {\r\n        onload && onload(audio)\r\n      })\r\n      audio.addEventListener('error', function (err) {\r\n        onerror && onerror(err)\r\n      })\r\n      document.body.appendChild(audio)\r\n    } else if (url.indexOf('data:audio') === 0) { // Base64 string\r\n      var base64 = url.split(',')[1]\r\n      var buffer = base64ToArrayBuffer(base64)\r\n      ctx.decodeAudioData(buffer, onload, onerror)\r\n    } else { // XMLHTTP buffer\r\n      var request = new window.XMLHttpRequest()\r\n      request.open('GET', url, true)\r\n      request.responseType = 'arraybuffer'\r\n      request.onload = function () {\r\n        ctx.decodeAudioData(request.response, onload, onerror)\r\n      }\r\n      request.send()\r\n    }\r\n  }\r\n\r\n  midi.recordCtxStartTime = (delay)=>{\r\n    let ctx = midi.getContext();\r\n    midi.ctxStartTime = ctx.currentTime + delay;\r\n  }\r\n\r\n  function createAudioContext () {\r\n    return new (window.AudioContext || window.webkitAudioContext)()\r\n  }\r\n})()\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/webaudio.js\n **/","/*\r\n  ----------------------------------------------------------------------\r\n  Web MIDI API - Native Soundbanks\r\n  ----------------------------------------------------------------------\r\n  http://webaudio.github.io/web-midi-api/\r\n  ----------------------------------------------------------------------\r\n*/\r\nimport root from '../root'\r\n\r\n(function () {\r\n  var plugin = null;\r\n  var output = null;\r\n  var midi = root.WebMIDI = {api: 'webmidi'}\r\n  var stateChanageEventCallback = null;\r\n  midi.outputs = [];\r\n\r\n\r\n  midi.send = function (data, delay) { // set channel volume\r\n    if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    output.send(data, delay * 1000)\r\n  }\r\n\r\n  midi.setController = function (event, channel, type, value, delay) {\r\n    if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    let rawdata = event.rawData\r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      rawdata = midi.setEventChannel(rawdata, root.MidiChannelMapping[channel])\r\n    }\r\n    output.send(rawdata, delay * 1000)\r\n    //output.send([channel, type, value], delay * 1000)\r\n  }\r\n\r\n  midi.setVolume = function (channel, volume, delay) { // set channel volume\r\n  if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      channel = root.MidiChannelMapping[channel]\r\n    }\r\n    output.send([0xB0 + channel, 0x07, volume], delay * 1000)\r\n  }\r\n\r\n  midi.programChange = function (event, channel, program, delay) { // change patch (instrument)\r\n    if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    return \r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      rawdata = midi.setEventChannel(rawdata, root.MidiChannelMapping[channel])\r\n    }\r\n    output.send(event.rawData, delay * 1000)\r\n    //output.send([0xC0 + channel, program], delay * 1000)\r\n  }\r\n\r\n  midi.pitchBend = function (event, channel, program, delay) { // pitch bend\r\n  if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    let rawdata = event.rawData\r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      rawdata = midi.setEventChannel(rawdata, root.MidiChannelMapping[channel])\r\n    }\r\n    output.send(rawdata,delay * 1000)\r\n    //console.log([0xE0 + channel, program],delay * 1000);\r\n    //output.send([0xE0 + channel, program], delay * 1000)\r\n  }\r\n\r\n  midi.noteOn = function (event, channel, note, velocity, delay) {\r\n    if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    let rawdata = event.rawData\r\n    //console.log(rawdata, channel, root.MidiChannelMapping[channel], root.MidiChannelMapping)\r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      rawdata = midi.setEventChannel(rawdata, root.MidiChannelMapping[channel])\r\n     // console.log(rawdata)\r\n    }\r\n    //console.log(\"noteOn\", delay * 1000 )\r\n    output.send(rawdata, delay * 1000)\r\n    //output.send([0x90 + channel, note, velocity], delay * 1000)\r\n  }\r\n\r\n  midi.noteOff = function (event, channel, note, delay) {\r\n    if(!output || !event.rawData){\r\n      return\r\n    }\r\n    delay += midi.ctxStartTime\r\n    let rawdata = event.rawData\r\n    if(root.MidiChannelMapping[channel] != undefined){\r\n      rawdata = midi.setEventChannel(rawdata, root.MidiChannelMapping[channel])\r\n    }\r\n    output.send(rawdata, delay * 1000)\r\n    //output.send([0x80 + channel, note, 0], delay * 1000)\r\n  }\r\n\r\n  midi.chordOn = function (channel, chord, velocity, delay) {\r\n    if(!output){\r\n      return\r\n    }\r\n      if(root.MidiChannelMapping[channel] != undefined){\r\n          channel = root.MidiChannelMapping[channel]\r\n      }\r\n    for (var n = 0; n < chord.length; n++) {\r\n      var note = chord[n]\r\n      output.send([0x90 + channel, note, velocity], delay * 1000)\r\n    }\r\n  }\r\n\r\n  midi.chordOff = function (channel, chord, delay) {\r\n    if(!output ){\r\n      return\r\n    }\r\n      if(root.MidiChannelMapping[channel] != undefined){\r\n          channel = root.MidiChannelMapping[channel]\r\n      }\r\n\r\n    \r\n    for (var n = 0; n < chord.length; n++) {\r\n      var note = chord[n]\r\n      output.send([0x80 + channel, note, 0], delay * 1000)\r\n    }\r\n  }\r\n\r\n  midi.stopAllNotes = function (delay, lookAhead, stopImmediatelyIfPossible = false) {\r\n    if(!output){\r\n      return\r\n    }\r\n    if(output.clear){\r\n      output.clear()\r\n    }\r\n\r\n    if (delay == 0){\r\n      delay = window.performance.now() / 1000\r\n    }\r\n    else{\r\n      delay += midi.ctxStartTime\r\n    }\r\n\r\n    //output.send([0x90, 100, 100], (lookAhead + delay) * 1000)\r\n    \r\n    for (var channel = 0; channel < 16; channel++) {\r\n      //output.send([0xB0 + channel, 0x7B, 0])\r\n      output.send([0xB0 + channel, 0x7B, 0], delay * 1000)\r\n      //output.send([0x80 + channel, 1, 1], delay * 1000)\r\n      // output.send([0xB0 + channel, 0x7B, 0])\r\n    }\r\n    //console.log(\"stopAllNotes\",lookAhead, (lookAhead + delay)*1000)\r\n    output.send([0xFC], delay * 1000)\r\n    // output.send([0xFC])\r\n  }\r\n\r\n  midi.connect = async function (opts) {\r\n    // console.log(opts)\r\n    // root.setDefaultPlugin(midi)\r\n    // var errFunction = function (err) { // well at least we tried!\r\n    //   if (window.AudioContext) { // Chrome\r\n    //     opts.api = 'webaudio'\r\n    //   } else if (window.Audio) { // Firefox\r\n    //     opts.api = 'audiotag'\r\n    //   } else { // no support\r\n    //     return err\r\n    //   }\r\n    //   root.loadPlugin(opts)\r\n    // }\r\n    // /\r\n    \r\n    \r\n    // console.log(output)\r\n    // if (output == undefined) { // nothing there...\r\n    //   errFunction()\r\n    // } else {\r\n    \r\n      // console.log( opts.onsuccess)\r\n      // opts.onsuccess && opts.onsuccess()\r\n    // }\r\n\r\n  }\r\n\r\n  midi.userConnect = async () => {\r\n    try {\r\n      var access = await navigator.requestMIDIAccess()\r\n      plugin = access;\r\n      console.log(access)\r\n      updateOutputList();\r\n      stateChanageEventCallback && stateChanageEventCallback(null)\r\n      access.onstatechange = (event) => {\r\n        //console.log(event);\r\n        updateOutputList();\r\n        stateChanageEventCallback && stateChanageEventCallback(event);\r\n      }\r\n\r\n      function updateOutputList() {\r\n        midi.outputs.clear();\r\n        var outputs = access.outputs;\r\n        if (typeof outputs === 'function') { // Chrome pre-43\r\n          outputs = outputs();\r\n        }\r\n        for (const out of outputs) {\r\n          midi.outputs.push(out[1]);\r\n        }\r\n      }\r\n      return true;\r\n    } catch (error) {\r\n      console.log(error)\r\n    }\r\n    return false;\r\n    \r\n  }\r\n\r\n  midi.setStateChangeEventListener = function (callback) {\r\n    stateChanageEventCallback = callback;\r\n  }\r\n\r\n  midi.setOutput= function (id) {\r\n    for (const out of midi.outputs) {\r\n      if(out.id == id){\r\n        output = out;\r\n        return;\r\n      }\r\n    }\r\n    output = null;\r\n  }\r\n\r\n  midi.setEventChannel = function(rawData, channelNum) {\r\n    rawData[0] = ( rawData[0] & 0xf0) | channelNum;\r\n    return rawData\r\n  }\r\n\r\n  midi.recordCtxStartTime = (delay) => {\r\n    midi.ctxStartTime = window.performance.now() / 1000 + delay\r\n  }\r\n})()\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/plugins/webmidi.js\n **/"],"sourceRoot":""}